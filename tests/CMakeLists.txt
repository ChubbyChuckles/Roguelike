# Ensure SDL doesn't redefine main() in any unit test binaries
add_compile_definitions(SDL_MAIN_HANDLED=1)

# Integration Plumbing Phase 0 Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_integration_manager.c)
    add_executable(test_integration_manager unit/test_integration_manager.c)
    target_link_libraries(test_integration_manager PRIVATE rogue_core)
    add_test(NAME test_integration_manager COMMAND test_integration_manager)
endif()

# AI Phase 5.2 Flow Field test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase5_2_flow_field.c AND NOT TARGET test_ai_phase5_2_flow_field)
    add_executable(test_ai_phase5_2_flow_field unit/test_ai_phase5_2_flow_field.c)
    target_link_libraries(test_ai_phase5_2_flow_field PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase5_2_flow_field PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase5_2_flow_field PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase5_2_flow_field COMMAND test_ai_phase5_2_flow_field)
endif()

# AI Phase 5.3 Local Avoidance test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase5_3_local_avoid.c AND NOT TARGET test_ai_phase5_3_local_avoid)
    add_executable(test_ai_phase5_3_local_avoid unit/test_ai_phase5_3_local_avoid.c)
    target_link_libraries(test_ai_phase5_3_local_avoid PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase5_3_local_avoid PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase5_3_local_avoid PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase5_3_local_avoid COMMAND test_ai_phase5_3_local_avoid)
endif()

# Phase 6.1 ranged projectile firing
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase6_1_ranged_projectile.c AND NOT TARGET test_ai_phase6_1_ranged_projectile)
    add_executable(test_ai_phase6_1_ranged_projectile unit/test_ai_phase6_1_ranged_projectile.c)
    target_link_libraries(test_ai_phase6_1_ranged_projectile PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase6_1_ranged_projectile PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase6_1_ranged_projectile PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase6_1_ranged_projectile COMMAND test_ai_phase6_1_ranged_projectile)
endif()

# Phase 1A haste snapshot & drift correction test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_skills_phase1a_haste_snapshot_and_drift.c AND NOT TARGET test_skills_phase1a_haste_snapshot_and_drift)
    add_executable(test_skills_phase1a_haste_snapshot_and_drift unit/test_skills_phase1a_haste_snapshot_and_drift.c)
    target_link_libraries(test_skills_phase1a_haste_snapshot_and_drift PRIVATE rogue_core)
    target_compile_definitions(test_skills_phase1a_haste_snapshot_and_drift PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_skills_phase1a_haste_snapshot_and_drift PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_skills_phase1a_haste_snapshot_and_drift COMMAND test_skills_phase1a_haste_snapshot_and_drift)
endif()

# Skills Phase 2 costs & refunds test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_skills_phase2_costs_refunds.c AND NOT TARGET test_skills_phase2_costs_refunds)
    add_executable(test_skills_phase2_costs_refunds unit/test_skills_phase2_costs_refunds.c)
    target_link_libraries(test_skills_phase2_costs_refunds PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_skills_phase2_costs_refunds PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_skills_phase2_costs_refunds PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_skills_phase2_costs_refunds COMMAND test_skills_phase2_costs_refunds)
endif()

# Skills Phase 2.4/2.5 Overdrive + Heat test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_skills_phase2_overdrive_heat.c AND NOT TARGET test_skills_phase2_overdrive_heat)
    add_executable(test_skills_phase2_overdrive_heat unit/test_skills_phase2_overdrive_heat.c)
    target_link_libraries(test_skills_phase2_overdrive_heat PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_skills_phase2_overdrive_heat PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_skills_phase2_overdrive_heat PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_skills_phase2_overdrive_heat COMMAND test_skills_phase2_overdrive_heat)
endif()

# Talents Phase 1B open allocation + cost-aware unlocks
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_talents_phase1b_open_allocation.c AND NOT TARGET test_talents_phase1b_open_allocation)
    add_executable(test_talents_phase1b_open_allocation unit/test_talents_phase1b_open_allocation.c)
    target_link_libraries(test_talents_phase1b_open_allocation PRIVATE rogue_core)
    target_compile_definitions(test_talents_phase1b_open_allocation PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_talents_phase1b_open_allocation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_talents_phase1b_open_allocation COMMAND test_talents_phase1b_open_allocation)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_talents_phase1b_dag_and_modifiers.c AND NOT TARGET test_talents_phase1b_dag_and_modifiers)
    add_executable(test_talents_phase1b_dag_and_modifiers unit/test_talents_phase1b_dag_and_modifiers.c)
    target_link_libraries(test_talents_phase1b_dag_and_modifiers PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_talents_phase1b_dag_and_modifiers PRIVATE SDL2::SDL2)
        target_compile_definitions(test_talents_phase1b_dag_and_modifiers PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_talents_phase1b_dag_and_modifiers PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_talents_phase1b_dag_and_modifiers COMMAND test_talents_phase1b_dag_and_modifiers)
endif()

# Talents Phase 1B ranks + hash stability test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_talents_phase1b_ranks_and_hash.c AND NOT TARGET test_talents_phase1b_ranks_and_hash)
    add_executable(test_talents_phase1b_ranks_and_hash unit/test_talents_phase1b_ranks_and_hash.c)
    target_link_libraries(test_talents_phase1b_ranks_and_hash PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_talents_phase1b_ranks_and_hash PRIVATE SDL2::SDL2)
        target_compile_definitions(test_talents_phase1b_ranks_and_hash PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_talents_phase1b_ranks_and_hash PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_talents_phase1b_ranks_and_hash COMMAND test_talents_phase1b_ranks_and_hash)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase6_2_reactions.c AND NOT TARGET test_ai_phase6_2_reactions)
    add_executable(test_ai_phase6_2_reactions unit/test_ai_phase6_2_reactions.c)
    target_link_libraries(test_ai_phase6_2_reactions PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase6_2_reactions PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase6_2_reactions PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase6_2_reactions COMMAND test_ai_phase6_2_reactions)
endif()

# Phase 6.3 Opportunistic attack
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase6_3_opportunistic.c AND NOT TARGET test_ai_phase6_3_opportunistic)
    add_executable(test_ai_phase6_3_opportunistic unit/test_ai_phase6_3_opportunistic.c)
    target_link_libraries(test_ai_phase6_3_opportunistic PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase6_3_opportunistic PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase6_3_opportunistic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase6_3_opportunistic COMMAND test_ai_phase6_3_opportunistic)
endif()

# Phase 6.4 Kiting logic (preferred distance band)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase6_4_kiting.c AND NOT TARGET test_ai_phase6_4_kiting)
    add_executable(test_ai_phase6_4_kiting unit/test_ai_phase6_4_kiting.c)
    target_link_libraries(test_ai_phase6_4_kiting PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase6_4_kiting PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase6_4_kiting PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase6_4_kiting COMMAND test_ai_phase6_4_kiting)
endif()

# Phase 6.5 Focus fire coordination (broadcast and decay)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase6_5_focus.c AND NOT TARGET test_ai_phase6_5_focus)
    add_executable(test_ai_phase6_5_focus unit/test_ai_phase6_5_focus.c)
    target_link_libraries(test_ai_phase6_5_focus PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase6_5_focus PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase6_5_focus PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase6_5_focus COMMAND test_ai_phase6_5_focus)
endif()

# Phase 6.6 Finisher execute below threshold (optional distance)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase6_6_finisher.c AND NOT TARGET test_ai_phase6_6_finisher)
    add_executable(test_ai_phase6_6_finisher unit/test_ai_phase6_6_finisher.c)
    target_link_libraries(test_ai_phase6_6_finisher PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase6_6_finisher PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase6_6_finisher PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase6_6_finisher COMMAND test_ai_phase6_6_finisher)
endif()

# Phase 6.7 Reaction delay and aggression gate decorators
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase6_7_decorators.c AND NOT TARGET test_ai_phase6_7_decorators)
    add_executable(test_ai_phase6_7_decorators unit/test_ai_phase6_7_decorators.c)
    target_link_libraries(test_ai_phase6_7_decorators PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase6_7_decorators PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase6_7_decorators PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase6_7_decorators COMMAND test_ai_phase6_7_decorators)
endif()

# Start Screen Phase 10 tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_start_screen_phase10_1_headless.c AND NOT TARGET test_start_screen_phase10_1_headless)
    add_executable(test_start_screen_phase10_1_headless unit/test_start_screen_phase10_1_headless.c)
    target_link_libraries(test_start_screen_phase10_1_headless PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_start_screen_phase10_1_headless PRIVATE SDL2::SDL2)
        target_compile_definitions(test_start_screen_phase10_1_headless PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_start_screen_phase10_1_headless PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_start_screen_phase10_1_headless COMMAND test_start_screen_phase10_1_headless)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_start_screen_phase10_2_navigation.c AND NOT TARGET test_start_screen_phase10_2_navigation)
    add_executable(test_start_screen_phase10_2_navigation unit/test_start_screen_phase10_2_navigation.c)
    target_link_libraries(test_start_screen_phase10_2_navigation PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_start_screen_phase10_2_navigation PRIVATE SDL2::SDL2)
        target_compile_definitions(test_start_screen_phase10_2_navigation PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_start_screen_phase10_2_navigation PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_start_screen_phase10_2_navigation COMMAND test_start_screen_phase10_2_navigation)
endif()

# Start Screen Phase 10.3 Localization swap test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_start_screen_phase10_3_localization.c AND NOT TARGET test_start_screen_phase10_3_localization)
    add_executable(test_start_screen_phase10_3_localization unit/test_start_screen_phase10_3_localization.c)
    target_link_libraries(test_start_screen_phase10_3_localization PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_start_screen_phase10_3_localization PRIVATE SDL2::SDL2)
        target_compile_definitions(test_start_screen_phase10_3_localization PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_start_screen_phase10_3_localization PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_start_screen_phase10_3_localization COMMAND test_start_screen_phase10_3_localization)
endif()

# Start Screen Phase 10.4 Reduced motion test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_start_screen_phase10_4_reduced_motion.c AND NOT TARGET test_start_screen_phase10_4_reduced_motion)
    add_executable(test_start_screen_phase10_4_reduced_motion unit/test_start_screen_phase10_4_reduced_motion.c)
    target_link_libraries(test_start_screen_phase10_4_reduced_motion PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_start_screen_phase10_4_reduced_motion PRIVATE SDL2::SDL2)
        target_compile_definitions(test_start_screen_phase10_4_reduced_motion PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_start_screen_phase10_4_reduced_motion PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_start_screen_phase10_4_reduced_motion COMMAND test_start_screen_phase10_4_reduced_motion)
endif()

# Phase 7 Group tactics & coordination tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase7_group_tactics.c AND NOT TARGET test_ai_phase7_group_tactics)
    add_executable(test_ai_phase7_group_tactics unit/test_ai_phase7_group_tactics.c)
    target_link_libraries(test_ai_phase7_group_tactics PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase7_group_tactics PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_ai_phase7_group_tactics PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase7_group_tactics COMMAND test_ai_phase7_group_tactics)
endif()

# Integration Plumbing Phase 2.3.4 Resource nodes JSON ingestion tests
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_resource_json.c AND NOT TARGET test_resource_json)
    add_executable(test_resource_json unit/test_resource_json.c)
    target_link_libraries(test_resource_json PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_resource_json PRIVATE SDL2::SDL2)
        target_compile_definitions(test_resource_json PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_resource_json COMMAND test_resource_json)
endif()

# Integration Plumbing Phase 2.3.4 Biome asset dependency validation tests
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_biome_assets_validate.c AND NOT TARGET test_biome_assets_validate)
    add_executable(test_biome_assets_validate unit/test_biome_assets_validate.c)
    target_link_libraries(test_biome_assets_validate PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_biome_assets_validate PRIVATE SDL2::SDL2)
        target_compile_definitions(test_biome_assets_validate PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_biome_assets_validate COMMAND test_biome_assets_validate)
endif()

# Integration Plumbing Phase 2.3.4 Biomes JSON loader/validation tests
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_worldgen_phase3_4_biome_json.c AND NOT TARGET test_worldgen_phase3_4_biome_json)
    add_executable(test_worldgen_phase3_4_biome_json unit/test_worldgen_phase3_4_biome_json.c)
    target_link_libraries(test_worldgen_phase3_4_biome_json PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_worldgen_phase3_4_biome_json PRIVATE SDL2::SDL2)
        target_compile_definitions(test_worldgen_phase3_4_biome_json PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase3_4_biome_json COMMAND test_worldgen_phase3_4_biome_json)
endif()

# Integration Plumbing Phase 5.4 Auto rollback on tx abort test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_sync_phase5_8_auto_rollback.c AND NOT TARGET test_sync_phase5_8_auto_rollback)
    add_executable(test_sync_phase5_8_auto_rollback unit/test_sync_phase5_8_auto_rollback.c)
    target_link_libraries(test_sync_phase5_8_auto_rollback PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_sync_phase5_8_auto_rollback PRIVATE SDL2::SDL2)
        target_compile_definitions(test_sync_phase5_8_auto_rollback PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_sync_phase5_8_auto_rollback COMMAND test_sync_phase5_8_auto_rollback)
endif()

# Integration Plumbing Phase 2.3.4 Vegetation JSON ingestion tests
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_vegetation_json.c AND NOT TARGET test_vegetation_json)
    add_executable(test_vegetation_json unit/test_vegetation_json.c)
    target_link_libraries(test_vegetation_json PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_vegetation_json PRIVATE SDL2::SDL2)
        target_compile_definitions(test_vegetation_json PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vegetation_json COMMAND test_vegetation_json)
endif()

# Integration Plumbing Phase 2.3.3 Materials & Crafting JSON tests
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_materials_and_gathering_json.c AND NOT TARGET test_materials_and_gathering_json)
    add_executable(test_materials_and_gathering_json unit/test_materials_and_gathering_json.c)
    target_link_libraries(test_materials_and_gathering_json PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_materials_and_gathering_json PRIVATE SDL2::SDL2)
        target_compile_definitions(test_materials_and_gathering_json PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_materials_and_gathering_json COMMAND test_materials_and_gathering_json)
endif()

if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_crafting_json_and_validations.c AND NOT TARGET test_crafting_json_and_validations)
    add_executable(test_crafting_json_and_validations unit/test_crafting_json_and_validations.c)
    target_link_libraries(test_crafting_json_and_validations PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_crafting_json_and_validations PRIVATE SDL2::SDL2)
        target_compile_definitions(test_crafting_json_and_validations PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_crafting_json_and_validations COMMAND test_crafting_json_and_validations)
endif()

# Integration Plumbing Phase 4.1 Unified Entity ID System Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_entity_id.c AND NOT TARGET test_entity_id)
    add_executable(test_entity_id unit/test_entity_id.c)
    target_link_libraries(test_entity_id PRIVATE rogue_core)
    add_test(NAME test_entity_id COMMAND test_entity_id)
endif()

# Integration Plumbing Phase 4.2 Shared Memory Pool System Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_memory_pool.c AND NOT TARGET test_memory_pool)
    add_executable(test_memory_pool unit/test_memory_pool.c)
    target_link_libraries(test_memory_pool PRIVATE rogue_core)
    add_test(NAME test_memory_pool COMMAND test_memory_pool)
endif()

# Integration Plumbing Phase 4.3 Cache Management & Invalidation Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_cache_system.c AND NOT TARGET test_cache_system)
    add_executable(test_cache_system unit/test_cache_system.c)
    target_link_libraries(test_cache_system PRIVATE rogue_core)
    add_test(NAME test_cache_system COMMAND test_cache_system)

    # Phase 4.4 reference counting & lifecycle management tests
    add_executable(test_ref_count unit/test_ref_count.c)
    target_include_directories(test_ref_count PRIVATE ${CMAKE_SOURCE_DIR}/src/core/integration)
    target_link_libraries(test_ref_count PRIVATE rogue_core)
    add_test(NAME test_ref_count COMMAND test_ref_count)
    # Phase 4.5 copy-on-write tests
    add_executable(test_cow unit/test_cow.c)
    target_include_directories(test_cow PRIVATE ${CMAKE_SOURCE_DIR}/src/core/integration)
    target_link_libraries(test_cow PRIVATE rogue_core)
    add_test(NAME test_cow COMMAND test_cow)
    # Phase 4.6 data structure versioning & migration tests
    add_executable(test_versioning unit/test_versioning.c)
    target_include_directories(test_versioning PRIVATE ${CMAKE_SOURCE_DIR}/src/core/integration)
    target_link_libraries(test_versioning PRIVATE rogue_core)
    add_test(NAME test_versioning COMMAND test_versioning)
    # Phase 4.7 shared resource access control tests
    add_executable(test_resource_lock unit/test_resource_lock.c)
    target_include_directories(test_resource_lock PRIVATE ${CMAKE_SOURCE_DIR}/src/core/integration)
    target_link_libraries(test_resource_lock PRIVATE rogue_core)
    add_test(NAME test_resource_lock COMMAND test_resource_lock)
endif()

# Integration Plumbing Phase 0.1 System Taxonomy Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_system_taxonomy.c)
    add_executable(test_system_taxonomy unit/test_system_taxonomy.c)
    target_link_libraries(test_system_taxonomy PRIVATE rogue_core)
    add_test(NAME test_system_taxonomy COMMAND test_system_taxonomy)
endif()

# Integration Plumbing Phase 1.1-1.7 Event Bus Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_event_bus.c)
    add_executable(test_event_bus unit/test_event_bus.c)
    target_link_libraries(test_event_bus PRIVATE rogue_core)
    add_test(NAME test_event_bus COMMAND test_event_bus)
endif()

# Integration Plumbing Phase 2.1 JSON Schema Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_json_schema.c)
    add_executable(test_json_schema unit/test_json_schema.c)
    target_link_libraries(test_json_schema PRIVATE rogue_core)
    add_test(NAME test_json_schema COMMAND test_json_schema)
endif()

# Integration Plumbing Phase 2.2 CFG Parser Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_cfg_parser.c)
    add_executable(test_cfg_parser unit/test_cfg_parser.c)
    target_link_libraries(test_cfg_parser PRIVATE rogue_core)
    add_test(NAME test_cfg_parser COMMAND test_cfg_parser)
endif()

# Integration Plumbing Phase 2.3 CFG Migration Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_cfg_migration.c)
    add_executable(test_cfg_migration unit/test_cfg_migration.c)
    target_link_libraries(test_cfg_migration PRIVATE rogue_core)
    add_test(NAME test_cfg_migration COMMAND test_cfg_migration)
endif()

# Integration Plumbing Phase 2.4 Hot Reload System Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_hot_reload.c)
    add_executable(test_hot_reload unit/test_hot_reload.c)
    target_link_libraries(test_hot_reload PRIVATE rogue_core)
    add_test(NAME test_hot_reload COMMAND test_hot_reload)
endif()

# Integration Plumbing Phase 2.5 Dependency Management System Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_dependency_manager.c)
    add_executable(test_dependency_manager unit/test_dependency_manager.c)
    target_link_libraries(test_dependency_manager PRIVATE rogue_core)
    add_test(NAME test_dependency_manager COMMAND test_dependency_manager)
endif()

# Integration Plumbing Phase 2.6 Configuration Version Management Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_config_version.c)
    add_executable(test_config_version unit/test_config_version.c)
    target_link_libraries(test_config_version PRIVATE rogue_core)
    add_test(NAME test_config_version COMMAND test_config_version)
endif()

# Integration Plumbing Phase 2.8 Configuration System Validation Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_config_system_validation.c)
    add_executable(test_config_system_validation unit/test_config_system_validation.c)
    target_link_libraries(test_config_system_validation PRIVATE rogue_core)
    add_test(NAME test_config_system_validation COMMAND test_config_system_validation)
endif()

# Integration Plumbing Phase 3.1 Enemy-AI Bridge Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_1_enemy_ai_bridge.c)
    add_executable(test_phase3_1_enemy_ai_bridge unit/test_phase3_1_enemy_ai_bridge.c)
    target_link_libraries(test_phase3_1_enemy_ai_bridge PRIVATE rogue_core)
    add_test(NAME test_phase3_1_enemy_ai_bridge COMMAND test_phase3_1_enemy_ai_bridge)
endif()

# Integration Plumbing Phase 3.2 Combat-Equipment Bridge Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_2_combat_equip_bridge.c)
    add_executable(test_phase3_2_combat_equip_bridge unit/test_phase3_2_combat_equip_bridge.c)
    target_link_libraries(test_phase3_2_combat_equip_bridge PRIVATE rogue_core)
    add_test(NAME test_phase3_2_combat_equip_bridge COMMAND test_phase3_2_combat_equip_bridge)
endif()

# Integration Plumbing Phase 3.2 Simple Test (for debugging)
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_2_simple.c)
    add_executable(test_phase3_2_simple unit/test_phase3_2_simple.c)
    target_link_libraries(test_phase3_2_simple PRIVATE rogue_core)
    add_test(NAME test_phase3_2_simple COMMAND test_phase3_2_simple)
endif()

# Integration Plumbing Phase 3.3 Combat-Progression Bridge Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_3_combat_progression_bridge.c)
    add_executable(test_phase3_3_combat_progression_bridge unit/test_phase3_3_combat_progression_bridge.c)
    target_link_libraries(test_phase3_3_combat_progression_bridge PRIVATE rogue_core)
    add_test(NAME test_phase3_3_combat_progression_bridge COMMAND test_phase3_3_combat_progression_bridge)
endif()

# Integration Plumbing Phase 3.7 WorldGen-Enemy Bridge Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/test_phase3_7_worldgen_enemy_bridge.c)
    add_executable(test_phase3_7_worldgen_enemy_bridge test_phase3_7_worldgen_enemy_bridge.c)
    target_link_libraries(test_phase3_7_worldgen_enemy_bridge PRIVATE rogue_core)
    add_test(NAME test_phase3_7_worldgen_enemy_bridge COMMAND test_phase3_7_worldgen_enemy_bridge)
endif()

# Integration Plumbing Phase 3.8 World Generation ↔ Resource/Gathering Bridge Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_8_worldgen_resource_bridge.c)
    add_executable(test_phase3_8_worldgen_resource_bridge unit/test_phase3_8_worldgen_resource_bridge.c)
    target_link_libraries(test_phase3_8_worldgen_resource_bridge PRIVATE rogue_core)
    add_test(NAME test_phase3_8_worldgen_resource_bridge COMMAND test_phase3_8_worldgen_resource_bridge)
endif()

# Integration Plumbing Phase 3.9 UI Integration Bridge Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_9_ui_integration_bridge.c)
    add_executable(test_phase3_9_ui_integration_bridge unit/test_phase3_9_ui_integration_bridge.c)
    target_link_libraries(test_phase3_9_ui_integration_bridge PRIVATE rogue_core)
    add_test(NAME test_phase3_9_ui_integration_bridge COMMAND test_phase3_9_ui_integration_bridge)
endif()

# Integration Plumbing Phase 3.10 Persistence Integration Bridge Test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_10_persistence_integration_bridge.c)
    add_executable(test_phase3_10_persistence_integration_bridge unit/test_phase3_10_persistence_integration_bridge.c)
    target_link_libraries(test_phase3_10_persistence_integration_bridge PRIVATE rogue_core)
    add_test(NAME test_phase3_10_persistence_integration_bridge COMMAND test_phase3_10_persistence_integration_bridge)
endif()


# Integration Plumbing Phase 3.3 Simple Test (for debugging)
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_phase3_3_simple.c)
    add_executable(test_phase3_3_simple unit/test_phase3_3_simple.c)
    target_link_libraries(test_phase3_3_simple PRIVATE rogue_core)
    add_test(NAME test_phase3_3_simple COMMAND test_phase3_3_simple)
endif()

# Integration Plumbing Phase 3.6.1 XP/LevelUp event publishing test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_progression_phase3_6_xp_events.c AND NOT TARGET test_progression_phase3_6_xp_events)
    add_executable(test_progression_phase3_6_xp_events unit/test_progression_phase3_6_xp_events.c)
    target_link_libraries(test_progression_phase3_6_xp_events PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_progression_phase3_6_xp_events PRIVATE SDL2::SDL2)
        target_compile_definitions(test_progression_phase3_6_xp_events PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase3_6_xp_events COMMAND test_progression_phase3_6_xp_events)
endif()

# Integration Plumbing Phase 3.6.2 Skill prerequisite gating + SKILL_UNLOCKED event test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_progression_phase3_6_skill_unlock.c AND NOT TARGET test_progression_phase3_6_skill_unlock)
    add_executable(test_progression_phase3_6_skill_unlock unit/test_progression_phase3_6_skill_unlock.c)
    target_link_libraries(test_progression_phase3_6_skill_unlock PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_progression_phase3_6_skill_unlock PRIVATE SDL2::SDL2)
        target_compile_definitions(test_progression_phase3_6_skill_unlock PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase3_6_skill_unlock COMMAND test_progression_phase3_6_skill_unlock)
endif()

# Phase 3.6.3 test: progression maze unlock gating
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_progression_phase3_6_maze_unlocks.c AND NOT TARGET test_progression_phase3_6_maze_unlocks)
    add_executable(test_progression_phase3_6_maze_unlocks unit/test_progression_phase3_6_maze_unlocks.c)
    target_link_libraries(test_progression_phase3_6_maze_unlocks PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_progression_phase3_6_maze_unlocks PRIVATE SDL2::SDL2)
        target_compile_definitions(test_progression_phase3_6_maze_unlocks PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase3_6_maze_unlocks COMMAND test_progression_phase3_6_maze_unlocks)
endif()

# Integration Plumbing Phase 3.6.4 Effect Scaling test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_progression_phase3_6_effect_scaling.c AND NOT TARGET test_progression_phase3_6_effect_scaling)
    add_executable(test_progression_phase3_6_effect_scaling unit/test_progression_phase3_6_effect_scaling.c)
    target_link_libraries(test_progression_phase3_6_effect_scaling PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_progression_phase3_6_effect_scaling PRIVATE SDL2::SDL2)
        target_compile_definitions(test_progression_phase3_6_effect_scaling PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase3_6_effect_scaling COMMAND test_progression_phase3_6_effect_scaling)
endif()

# Phase 3.6.5: Mastery integration test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_progression_phase3_6_mastery_integration.c AND NOT TARGET test_progression_phase3_6_mastery_integration)
    add_executable(test_progression_phase3_6_mastery_integration unit/test_progression_phase3_6_mastery_integration.c)
    target_link_libraries(test_progression_phase3_6_mastery_integration PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_progression_phase3_6_mastery_integration PRIVATE SDL2::SDL2)
        target_compile_definitions(test_progression_phase3_6_mastery_integration PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase3_6_mastery_integration COMMAND test_progression_phase3_6_mastery_integration)
endif()

# Phase 3.6.6: Skill specialization paths test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_progression_phase3_6_specialization.c AND NOT TARGET test_progression_phase3_6_specialization)
    add_executable(test_progression_phase3_6_specialization unit/test_progression_phase3_6_specialization.c)
    target_link_libraries(test_progression_phase3_6_specialization PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_progression_phase3_6_specialization PRIVATE SDL2::SDL2)
        target_compile_definitions(test_progression_phase3_6_specialization PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase3_6_specialization COMMAND test_progression_phase3_6_specialization)
endif()

# Integration Plumbing Phase 2.2 CFG File Analysis Test (manual run)
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_cfg_file_analysis.c)
    add_executable(test_cfg_file_analysis unit/test_cfg_file_analysis.c)
    target_link_libraries(test_cfg_file_analysis PRIVATE rogue_core)
endif()

# Phase 5 crafting skill test explicit add (ensure included regardless of glob ordering)
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_crafting_phase5_skill.c)
    add_executable(test_crafting_phase5_skill unit/test_crafting_phase5_skill.c)
    target_link_libraries(test_crafting_phase5_skill PRIVATE rogue_core)
    add_test(NAME test_crafting_phase5_skill COMMAND test_crafting_phase5_skill)
endif()

# Progression Phase 6.2-6.5 mastery extended test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_progression_phase6_mastery_extended.c)
    add_executable(test_progression_phase6_mastery_extended unit/test_progression_phase6_mastery_extended.c)
    target_link_libraries(test_progression_phase6_mastery_extended PRIVATE rogue_core)
    add_test(NAME test_progression_phase6_mastery_extended COMMAND test_progression_phase6_mastery_extended)
endif()

# Phase 6 enhancement pathways test
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_crafting_phase6_enhancement.c)
    add_executable(test_crafting_phase6_enhancement unit/test_crafting_phase6_enhancement.c)
    target_link_libraries(test_crafting_phase6_enhancement PRIVATE rogue_core)
    add_test(NAME test_crafting_phase6_enhancement COMMAND test_crafting_phase6_enhancement)
endif()
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_crafting_phase6_3_transmute_scaling.c)
    add_executable(test_crafting_phase6_3_transmute_scaling unit/test_crafting_phase6_3_transmute_scaling.c)
    target_link_libraries(test_crafting_phase6_3_transmute_scaling PRIVATE rogue_core)
    add_test(NAME test_crafting_phase6_3_transmute_scaling COMMAND test_crafting_phase6_3_transmute_scaling)
endif()
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_crafting_phase7_rng_journal.c)
    add_executable(test_crafting_phase7_rng_journal unit/test_crafting_phase7_rng_journal.c)
    target_link_libraries(test_crafting_phase7_rng_journal PRIVATE rogue_core)
    add_test(NAME test_crafting_phase7_rng_journal COMMAND test_crafting_phase7_rng_journal)
endif()
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_crafting_phase7_determinism.c)
    add_executable(test_crafting_phase7_determinism unit/test_crafting_phase7_determinism.c)
    target_link_libraries(test_crafting_phase7_determinism PRIVATE rogue_core)
    add_test(NAME test_crafting_phase7_determinism COMMAND test_crafting_phase7_determinism)
endif()
# Loot filter predicate evaluation test (Itemsystem 12.7)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_geometry.c AND NOT TARGET test_hit_geometry)
    add_executable(test_hit_geometry unit/test_hit_geometry.c)
    target_link_libraries(test_hit_geometry PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_geometry PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_geometry COMMAND test_hit_geometry)
endif()

# Phase 13: Vendor Journal Compaction Summary Test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase13_compaction.c AND NOT TARGET test_vendor_phase13_compaction)
    add_executable(test_vendor_phase13_compaction unit/test_vendor_phase13_compaction.c)
    target_link_libraries(test_vendor_phase13_compaction PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_vendor_phase13_compaction PRIVATE ROGUE_HAVE_SDL=1)
        endif()
    add_test(NAME test_vendor_phase13_compaction COMMAND test_vendor_phase13_compaction)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_sweep_normals.c AND NOT TARGET test_hit_sweep_normals)
    add_executable(test_hit_sweep_normals unit/test_hit_sweep_normals.c)
    target_link_libraries(test_hit_sweep_normals PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_sweep_normals PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_sweep_normals COMMAND test_hit_sweep_normals)
endif()

# Integration Plumbing Phase 4.8 Shared Data Structure Validation aggregate tests
if(EXISTS ${CMAKE_CURRENT_LIST_DIR}/unit/test_integration_phase4_8_shared_validation.c AND NOT TARGET test_integration_phase4_8_shared_validation)
    add_executable(test_integration_phase4_8_shared_validation unit/test_integration_phase4_8_shared_validation.c)
    target_link_libraries(test_integration_phase4_8_shared_validation PRIVATE rogue_core)
    add_test(NAME test_integration_phase4_8_shared_validation COMMAND test_integration_phase4_8_shared_validation)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_knockback_basic.c AND NOT TARGET test_knockback_basic)
    add_executable(test_knockback_basic unit/test_knockback_basic.c)
    target_link_libraries(test_knockback_basic PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_knockback_basic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_knockback_basic COMMAND test_knockback_basic)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_phase4_feedback.c AND NOT TARGET test_hit_phase4_feedback)
    add_executable(test_hit_phase4_feedback unit/test_hit_phase4_feedback.c)
    target_link_libraries(test_hit_phase4_feedback PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_phase4_feedback PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_phase4_feedback COMMAND test_hit_phase4_feedback)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_phase6_debug_toggle.c AND NOT TARGET test_hit_phase6_debug_toggle)
    add_executable(test_hit_phase6_debug_toggle unit/test_hit_phase6_debug_toggle.c)
    target_link_libraries(test_hit_phase6_debug_toggle PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_phase6_debug_toggle PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_phase6_debug_toggle COMMAND test_hit_phase6_debug_toggle)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_mask_basic.c AND NOT TARGET test_hit_mask_basic)
    add_executable(test_hit_mask_basic unit/test_hit_mask_basic.c)
    target_link_libraries(test_hit_mask_basic PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_mask_basic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_mask_basic COMMAND test_hit_mask_basic)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_mask_mismatch.c AND NOT TARGET test_hit_mask_mismatch)
    add_executable(test_hit_mask_mismatch unit/test_hit_mask_mismatch.c)
    target_link_libraries(test_hit_mask_mismatch PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_mask_mismatch PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_mask_mismatch COMMAND test_hit_mask_mismatch)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_difficulty_phase0.c AND NOT TARGET test_enemy_difficulty_phase0)
    add_executable(test_enemy_difficulty_phase0 unit/test_enemy_difficulty_phase0.c)
    target_link_libraries(test_enemy_difficulty_phase0 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_enemy_difficulty_phase0 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_difficulty_phase0 COMMAND test_enemy_difficulty_phase0)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_difficulty_phase1.c AND NOT TARGET test_enemy_difficulty_phase1)
    add_executable(test_enemy_difficulty_phase1 unit/test_enemy_difficulty_phase1.c)
    target_link_libraries(test_enemy_difficulty_phase1 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_enemy_difficulty_phase1 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_difficulty_phase1 COMMAND test_enemy_difficulty_phase1)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_difficulty_phase1_ext.c AND NOT TARGET test_enemy_difficulty_phase1_ext)
    add_executable(test_enemy_difficulty_phase1_ext unit/test_enemy_difficulty_phase1_ext.c)
    target_link_libraries(test_enemy_difficulty_phase1_ext PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_enemy_difficulty_phase1_ext PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_difficulty_phase1_ext COMMAND test_enemy_difficulty_phase1_ext)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_difficulty_phase2.c AND NOT TARGET test_enemy_difficulty_phase2)
    add_executable(test_enemy_difficulty_phase2 unit/test_enemy_difficulty_phase2.c)
    target_link_libraries(test_enemy_difficulty_phase2 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_enemy_difficulty_phase2 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_difficulty_phase2 COMMAND test_enemy_difficulty_phase2)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_difficulty_phase3.c AND NOT TARGET test_enemy_difficulty_phase3)
    add_executable(test_enemy_difficulty_phase3 unit/test_enemy_difficulty_phase3.c)
    target_link_libraries(test_enemy_difficulty_phase3 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_enemy_difficulty_phase3 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_difficulty_phase3 COMMAND test_enemy_difficulty_phase3)
endif()

# Vendor Phase 2 inventory template & seed tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase2_inventory.c AND NOT TARGET test_vendor_phase2_inventory)
    add_executable(test_vendor_phase2_inventory unit/test_vendor_phase2_inventory.c)
    target_link_libraries(test_vendor_phase2_inventory PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vendor_phase2_inventory PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase2_inventory COMMAND test_vendor_phase2_inventory)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase2_constrained.c AND NOT TARGET test_vendor_phase2_constrained)
    add_executable(test_vendor_phase2_constrained unit/test_vendor_phase2_constrained.c)
    target_link_libraries(test_vendor_phase2_constrained PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase2_constrained PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase2_constrained PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase2_constrained COMMAND test_vendor_phase2_constrained)
endif()

# Vendor Phase 3 pricing engine test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase3_pricing.c AND NOT TARGET test_vendor_phase3_pricing)
    add_executable(test_vendor_phase3_pricing unit/test_vendor_phase3_pricing.c)
    target_link_libraries(test_vendor_phase3_pricing PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase3_pricing PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase3_pricing PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase3_pricing COMMAND test_vendor_phase3_pricing)
endif()

# Vendor Phase 4 reputation & negotiation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase4_reputation_negotiation.c AND NOT TARGET test_vendor_phase4_reputation_negotiation)
    add_executable(test_vendor_phase4_reputation_negotiation unit/test_vendor_phase4_reputation_negotiation.c)
    target_link_libraries(test_vendor_phase4_reputation_negotiation PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase4_reputation_negotiation PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase4_reputation_negotiation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase4_reputation_negotiation COMMAND test_vendor_phase4_reputation_negotiation)
endif()

# Vendor Phase 5 buyback & transaction journal test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase5_buyback_journal.c AND NOT TARGET test_vendor_phase5_buyback_journal)
    add_executable(test_vendor_phase5_buyback_journal unit/test_vendor_phase5_buyback_journal.c)
    target_link_libraries(test_vendor_phase5_buyback_journal PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase5_buyback_journal PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase5_buyback_journal PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase5_buyback_journal COMMAND test_vendor_phase5_buyback_journal)
endif()

# Vendor Phase 6 special offers & rotations test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase6_special_offers.c AND NOT TARGET test_vendor_phase6_special_offers)
    add_executable(test_vendor_phase6_special_offers unit/test_vendor_phase6_special_offers.c)
    target_link_libraries(test_vendor_phase6_special_offers PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase6_special_offers PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase6_special_offers PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase6_special_offers COMMAND test_vendor_phase6_special_offers)
endif()

# Vendor Phase 7 currency & sink mechanics test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase7_sinks.c AND NOT TARGET test_vendor_phase7_sinks)
    add_executable(test_vendor_phase7_sinks unit/test_vendor_phase7_sinks.c)
    target_link_libraries(test_vendor_phase7_sinks PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase7_sinks PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase7_sinks PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase7_sinks COMMAND test_vendor_phase7_sinks)
endif()

# Vendor Phase 8 crafting integration test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase8_crafting_integration.c AND NOT TARGET test_vendor_phase8_crafting_integration)
    add_executable(test_vendor_phase8_crafting_integration unit/test_vendor_phase8_crafting_integration.c)
    target_link_libraries(test_vendor_phase8_crafting_integration PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase8_crafting_integration PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase8_crafting_integration PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase8_crafting_integration COMMAND test_vendor_phase8_crafting_integration)
endif()

# Vendor Phase 9 adaptive behavior test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase9_adaptive.c AND NOT TARGET test_vendor_phase9_adaptive)
    add_executable(test_vendor_phase9_adaptive unit/test_vendor_phase9_adaptive.c)
    target_link_libraries(test_vendor_phase9_adaptive PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase9_adaptive PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase9_adaptive PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase9_adaptive COMMAND test_vendor_phase9_adaptive)
endif()

# Vendor Phase 10 multi-vendor balancing test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase10_balancing.c AND NOT TARGET test_vendor_phase10_balancing)
    add_executable(test_vendor_phase10_balancing unit/test_vendor_phase10_balancing.c)
    target_link_libraries(test_vendor_phase10_balancing PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase10_balancing PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase10_balancing PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase10_balancing COMMAND test_vendor_phase10_balancing)
endif()

# Vendor Phase 11 performance & memory test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase11_perf.c AND NOT TARGET test_vendor_phase11_perf)
    add_executable(test_vendor_phase11_perf unit/test_vendor_phase11_perf.c)
    target_link_libraries(test_vendor_phase11_perf PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_vendor_phase11_perf PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_vendor_phase11_perf PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase11_perf COMMAND test_vendor_phase11_perf)
endif()

# Crafting & Gathering Phase 0-1 material registry test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_crafting_phase0_1_material_registry.c AND NOT TARGET test_crafting_phase0_1_material_registry)
    add_executable(test_crafting_phase0_1_material_registry unit/test_crafting_phase0_1_material_registry.c)
    target_link_libraries(test_crafting_phase0_1_material_registry PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_crafting_phase0_1_material_registry PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_crafting_phase0_1_material_registry PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_crafting_phase0_1_material_registry COMMAND test_crafting_phase0_1_material_registry)
endif()

# Crafting & Gathering Phase 2 gathering nodes test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_crafting_phase2_gathering.c AND NOT TARGET test_crafting_phase2_gathering)
    add_executable(test_crafting_phase2_gathering unit/test_crafting_phase2_gathering.c)
    target_link_libraries(test_crafting_phase2_gathering PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_crafting_phase2_gathering PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_crafting_phase2_gathering PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_crafting_phase2_gathering COMMAND test_crafting_phase2_gathering)
endif()

# Crafting & Gathering Phase 3 refinement test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_crafting_phase3_refinement.c AND NOT TARGET test_crafting_phase3_refinement)
    add_executable(test_crafting_phase3_refinement unit/test_crafting_phase3_refinement.c)
    target_link_libraries(test_crafting_phase3_refinement PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_crafting_phase3_refinement PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_crafting_phase3_refinement PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_crafting_phase3_refinement COMMAND test_crafting_phase3_refinement)
endif()
 # Crafting & Gathering Phase 4 recipe parsing test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_crafting_phase4_recipes.c AND NOT TARGET test_crafting_phase4_recipes)
    add_executable(test_crafting_phase4_recipes unit/test_crafting_phase4_recipes.c)
    target_link_libraries(test_crafting_phase4_recipes PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_crafting_phase4_recipes PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_crafting_phase4_recipes PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_crafting_phase4_recipes COMMAND test_crafting_phase4_recipes)
endif()
 # Crafting & Gathering Phase 4 queue & stations test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_crafting_phase4_queue.c AND NOT TARGET test_crafting_phase4_queue)
    add_executable(test_crafting_phase4_queue unit/test_crafting_phase4_queue.c)
    target_link_libraries(test_crafting_phase4_queue PRIVATE rogue_core)
    if(TARGET SDL2::SDL2main)
        target_link_libraries(test_crafting_phase4_queue PRIVATE SDL2::SDL2main SDL2::SDL2)
        target_compile_definitions(test_crafting_phase4_queue PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_crafting_phase4_queue COMMAND test_crafting_phase4_queue)
endif()
# Phase 4 adaptive difficulty test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_difficulty_phase4.c AND NOT TARGET test_enemy_difficulty_phase4)
    add_executable(test_enemy_difficulty_phase4 unit/test_enemy_difficulty_phase4.c)
    target_link_libraries(test_enemy_difficulty_phase4 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_enemy_difficulty_phase4 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_difficulty_phase4 COMMAND test_enemy_difficulty_phase4)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_difficulty_phase5.c AND NOT TARGET test_enemy_difficulty_phase5)
    add_executable(test_enemy_difficulty_phase5 unit/test_enemy_difficulty_phase5.c)
    target_link_libraries(test_enemy_difficulty_phase5 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_enemy_difficulty_phase5 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_difficulty_phase5 COMMAND test_enemy_difficulty_phase5)
endif()

# Character Progression Phase 0 taxonomy test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase0_taxonomy.c AND NOT TARGET test_progression_phase0_taxonomy)
    add_executable(test_progression_phase0_taxonomy unit/test_progression_phase0_taxonomy.c)
    target_link_libraries(test_progression_phase0_taxonomy PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase0_taxonomy PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase0_taxonomy COMMAND test_progression_phase0_taxonomy)
endif()

# Character Progression Phase 1 XP curve test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase1_xp_curve.c AND NOT TARGET test_progression_phase1_xp_curve)
    add_executable(test_progression_phase1_xp_curve unit/test_progression_phase1_xp_curve.c)
    target_link_libraries(test_progression_phase1_xp_curve PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase1_xp_curve PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase1_xp_curve COMMAND test_progression_phase1_xp_curve)
endif()

# Character Progression Phase 2 attribute allocation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase2_attributes.c AND NOT TARGET test_progression_phase2_attributes)
    add_executable(test_progression_phase2_attributes unit/test_progression_phase2_attributes.c)
    target_link_libraries(test_progression_phase2_attributes PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase2_attributes PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase2_attributes COMMAND test_progression_phase2_attributes)
endif()

# Character Progression Phase 3 ratings test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase3_ratings.c AND NOT TARGET test_progression_phase3_ratings)
    add_executable(test_progression_phase3_ratings unit/test_progression_phase3_ratings.c)
    target_link_libraries(test_progression_phase3_ratings PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase3_ratings PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase3_ratings COMMAND test_progression_phase3_ratings)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase4_maze.c AND NOT TARGET test_progression_phase4_maze)
    add_executable(test_progression_phase4_maze unit/test_progression_phase4_maze.c)
    target_link_libraries(test_progression_phase4_maze PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase4_maze PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase4_maze COMMAND test_progression_phase4_maze)
endif()

# Character Progression Phase 5 passive unlock integration test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase5_passives.c AND NOT TARGET test_progression_phase5_passives)
    add_executable(test_progression_phase5_passives unit/test_progression_phase5_passives.c)
    target_link_libraries(test_progression_phase5_passives PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase5_passives PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase5_passives COMMAND test_progression_phase5_passives)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_mastery.c AND NOT TARGET test_progression_mastery)
    add_executable(test_progression_mastery unit/test_progression_mastery.c)
    target_link_libraries(test_progression_mastery PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_mastery PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_mastery COMMAND test_progression_mastery)
endif()

# Character Progression Phase 7 ring expansion & keystone heuristic scaffold test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase7_rings.c AND NOT TARGET test_progression_phase7_rings)
    add_executable(test_progression_phase7_rings unit/test_progression_phase7_rings.c)
    target_link_libraries(test_progression_phase7_rings PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase7_rings PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase7_rings COMMAND test_progression_phase7_rings)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase7_visualization.c AND NOT TARGET test_progression_phase7_visualization)
    add_executable(test_progression_phase7_visualization unit/test_progression_phase7_visualization.c)
    target_link_libraries(test_progression_phase7_visualization PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase7_visualization PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase7_visualization COMMAND test_progression_phase7_visualization)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase8_perpetual.c AND NOT TARGET test_progression_phase8_perpetual)
    add_executable(test_progression_phase8_perpetual unit/test_progression_phase8_perpetual.c)
    target_link_libraries(test_progression_phase8_perpetual PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase8_perpetual PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase8_perpetual COMMAND test_progression_phase8_perpetual)
endif()

# Character Progression Phase 9 synergy test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase9_synergy.c AND NOT TARGET test_progression_phase9_synergy)
    add_executable(test_progression_phase9_synergy unit/test_progression_phase9_synergy.c)
    target_link_libraries(test_progression_phase9_synergy PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase9_synergy PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase9_synergy COMMAND test_progression_phase9_synergy)
endif()

# Character Progression Phase 10 buffs/debuff integration test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase10_buffs.c AND NOT TARGET test_progression_phase10_buffs)
    add_executable(test_progression_phase10_buffs unit/test_progression_phase10_buffs.c)
    target_link_libraries(test_progression_phase10_buffs PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase10_buffs PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase10_buffs COMMAND test_progression_phase10_buffs)
endif()

# Character Progression Phase 11 cache/dirty flags performance scaffolding test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase11_cache.c AND NOT TARGET test_progression_phase11_cache)
    add_executable(test_progression_phase11_cache unit/test_progression_phase11_cache.c)
    target_link_libraries(test_progression_phase11_cache PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase11_cache PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase11_cache COMMAND test_progression_phase11_cache)
endif()

# Character Progression Phase 11 benchmark (non-failing performance signal)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase11_bench.c AND NOT TARGET test_progression_phase11_bench)
    add_executable(test_progression_phase11_bench unit/test_progression_phase11_bench.c)
    target_link_libraries(test_progression_phase11_bench PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase11_bench PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase11_bench COMMAND test_progression_phase11_bench)
endif()

# Character Progression Phase 11 re-spec stale cache test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase11_respec.c AND NOT TARGET test_progression_phase11_respec)
    add_executable(test_progression_phase11_respec unit/test_progression_phase11_respec.c)
    target_link_libraries(test_progression_phase11_respec PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase11_respec PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase11_respec COMMAND test_progression_phase11_respec)
endif()

# Character Progression Phase 12 persistence & migration test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase12_persistence.c AND NOT TARGET test_progression_phase12_persistence)
    add_executable(test_progression_phase12_persistence unit/test_progression_phase12_persistence.c)
    target_link_libraries(test_progression_phase12_persistence PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase12_persistence PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase12_persistence COMMAND test_progression_phase12_persistence)
endif()

# Character Progression Phase 12 V3 extended persistence test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase12_v3.c AND NOT TARGET test_progression_phase12_v3)
    add_executable(test_progression_phase12_v3 unit/test_progression_phase12_v3.c)
    target_link_libraries(test_progression_phase12_v3 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase12_v3 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase12_v3 COMMAND test_progression_phase12_v3)
endif()

# Character Progression Phase 7.3 anti-stack safeguards test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_progression_phase7_antistack.c AND NOT TARGET test_progression_phase7_antistack)
    add_executable(test_progression_phase7_antistack unit/test_progression_phase7_antistack.c)
    target_link_libraries(test_progression_phase7_antistack PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_progression_phase7_antistack PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_progression_phase7_antistack COMMAND test_progression_phase7_antistack)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_json_loader.c AND NOT TARGET test_enemy_json_loader)
    add_executable(test_enemy_json_loader unit/test_enemy_json_loader.c)
    target_link_libraries(test_enemy_json_loader PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_compile_definitions(test_enemy_json_loader PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_json_loader COMMAND test_enemy_json_loader)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_integration_phase0.c AND NOT TARGET test_enemy_integration_phase0)
    add_executable(test_enemy_integration_phase0 unit/test_enemy_integration_phase0.c)
    target_link_libraries(test_enemy_integration_phase0 PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_compile_definitions(test_enemy_integration_phase0 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_integration_phase0 COMMAND test_enemy_integration_phase0)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_integration_phase1.c AND NOT TARGET test_enemy_integration_phase1)
    add_executable(test_enemy_integration_phase1 unit/test_enemy_integration_phase1.c)
    target_link_libraries(test_enemy_integration_phase1 PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_compile_definitions(test_enemy_integration_phase1 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_integration_phase1 COMMAND test_enemy_integration_phase1)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_integration_phase2.c AND NOT TARGET test_enemy_integration_phase2)
    add_executable(test_enemy_integration_phase2 unit/test_enemy_integration_phase2.c)
    target_link_libraries(test_enemy_integration_phase2 PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_compile_definitions(test_enemy_integration_phase2 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_integration_phase2 COMMAND test_enemy_integration_phase2)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_integration_phase3.c AND NOT TARGET test_enemy_integration_phase3)
    add_executable(test_enemy_integration_phase3 unit/test_enemy_integration_phase3.c)
    target_link_libraries(test_enemy_integration_phase3 PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_compile_definitions(test_enemy_integration_phase3 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_integration_phase3 COMMAND test_enemy_integration_phase3)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_integration_phase5.c AND NOT TARGET test_enemy_integration_phase5)
    add_executable(test_enemy_integration_phase5 unit/test_enemy_integration_phase5.c)
    target_link_libraries(test_enemy_integration_phase5 PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_compile_definitions(test_enemy_integration_phase5 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_integration_phase5 COMMAND test_enemy_integration_phase5)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_enemy_integration_phase6.c AND NOT TARGET test_enemy_integration_phase6)
    add_executable(test_enemy_integration_phase6 unit/test_enemy_integration_phase6.c)
    target_link_libraries(test_enemy_integration_phase6 PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_compile_definitions(test_enemy_integration_phase6 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_enemy_integration_phase6 COMMAND test_enemy_integration_phase6)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_phase7_integration.c AND NOT TARGET test_hit_phase7_integration)
    add_executable(test_hit_phase7_integration unit/test_hit_phase7_integration.c)
    target_link_libraries(test_hit_phase7_integration PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_phase7_integration PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_phase7_integration COMMAND test_hit_phase7_integration)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_filter_predicates.c AND NOT TARGET test_loot_filter_predicates)
    add_executable(test_loot_filter_predicates unit/test_loot_filter_predicates.c)
    target_link_libraries(test_loot_filter_predicates PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_filter_predicates PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_filter_predicates COMMAND test_loot_filter_predicates)
endif()

# Inventory Phase 1 unique entries test (1.1-1.5)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase1_unique_entries.c AND NOT TARGET test_inventory_phase1_unique_entries)
    add_executable(test_inventory_phase1_unique_entries unit/test_inventory_phase1_unique_entries.c)
    target_link_libraries(test_inventory_phase1_unique_entries PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase1_unique_entries PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase1_unique_entries COMMAND test_inventory_phase1_unique_entries)
endif()

# Inventory Phase 1 extended (labels, delta, cap handler) tests (1.3,1.6,1.7)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase1_labels_delta.c AND NOT TARGET test_inventory_phase1_labels_delta)
    add_executable(test_inventory_phase1_labels_delta unit/test_inventory_phase1_labels_delta.c)
    target_link_libraries(test_inventory_phase1_labels_delta PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase1_labels_delta PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase1_labels_delta COMMAND test_inventory_phase1_labels_delta)
endif()

# Inventory Phase 1 persistence integration test (1.6) – verifies save/load of entry model
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase1_persistence.c AND NOT TARGET test_inventory_phase1_persistence)
    add_executable(test_inventory_phase1_persistence unit/test_inventory_phase1_persistence.c)
    target_link_libraries(test_inventory_phase1_persistence PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase1_persistence PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase1_persistence COMMAND test_inventory_phase1_persistence)
endif()

# Inventory Phase 3 tags & flags test (3.1/3.2 partial scope) – favorites/locks + tag persistence
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase3_tags.c AND NOT TARGET test_inventory_phase3_tags)
    add_executable(test_inventory_phase3_tags unit/test_inventory_phase3_tags.c)
    target_link_libraries(test_inventory_phase3_tags PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase3_tags PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase3_tags COMMAND test_inventory_phase3_tags)
endif()

# Inventory Phase 3 auto-tag rules test (3.3/3.4 persistence + application)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase3_rules.c AND NOT TARGET test_inventory_phase3_rules)
    add_executable(test_inventory_phase3_rules unit/test_inventory_phase3_rules.c)
    target_link_libraries(test_inventory_phase3_rules PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase3_rules PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase3_rules COMMAND test_inventory_phase3_rules)
endif()

# Inventory Phase 3 rule enforcement & determinism test (3.6)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase3_lock_rule_enforce.c AND NOT TARGET test_inventory_phase3_lock_rule_enforce)
    add_executable(test_inventory_phase3_lock_rule_enforce unit/test_inventory_phase3_lock_rule_enforce.c)
    target_link_libraries(test_inventory_phase3_lock_rule_enforce PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase3_lock_rule_enforce PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase3_lock_rule_enforce COMMAND test_inventory_phase3_lock_rule_enforce)
endif()

# Inventory Phase 4 query & sorting initial test (4.1-4.3 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase4_query_sort.c AND NOT TARGET test_inventory_phase4_query_sort)
    add_executable(test_inventory_phase4_query_sort unit/test_inventory_phase4_query_sort.c)
    target_link_libraries(test_inventory_phase4_query_sort PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase4_query_sort PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase4_query_sort COMMAND test_inventory_phase4_query_sort)
endif()

# Inventory Phase 4 saved searches test (4.4 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase4_saved_searches.c AND NOT TARGET test_inventory_phase4_saved_searches)
    add_executable(test_inventory_phase4_saved_searches unit/test_inventory_phase4_saved_searches.c)
    target_link_libraries(test_inventory_phase4_saved_searches PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase4_saved_searches PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase4_saved_searches COMMAND test_inventory_phase4_saved_searches)
endif()

# Inventory Phase 4 saved searches persistence test (4.4 persistence)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase4_saved_searches_persist.c AND NOT TARGET test_inventory_phase4_saved_searches_persist)
    add_executable(test_inventory_phase4_saved_searches_persist unit/test_inventory_phase4_saved_searches_persist.c)
    target_link_libraries(test_inventory_phase4_saved_searches_persist PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase4_saved_searches_persist PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase4_saved_searches_persist COMMAND test_inventory_phase4_saved_searches_persist)
endif()

# Inventory Phase 4 query result cache test (4.6)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase4_query_cache.c AND NOT TARGET test_inventory_phase4_query_cache)
    add_executable(test_inventory_phase4_query_cache unit/test_inventory_phase4_query_cache.c)
    target_link_libraries(test_inventory_phase4_query_cache PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase4_query_cache PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase4_query_cache COMMAND test_inventory_phase4_query_cache)
endif()

# Inventory Phase 4 quick actions test (4.4 UI binding)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_phase4_quick_actions.c AND NOT TARGET test_inventory_phase4_quick_actions)
    add_executable(test_inventory_phase4_quick_actions unit/test_inventory_phase4_quick_actions.c)
    target_link_libraries(test_inventory_phase4_quick_actions PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_inventory_phase4_quick_actions PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_inventory_phase4_quick_actions COMMAND test_inventory_phase4_quick_actions)
endif()

# Equipment Phase 5 sockets test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase5_sockets.c AND NOT TARGET test_equipment_phase5_sockets)
    add_executable(test_equipment_phase5_sockets unit/test_equipment_phase5_sockets.c)
    target_link_libraries(test_equipment_phase5_sockets PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase5_sockets PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase5_sockets COMMAND test_equipment_phase5_sockets)
endif()

# Equipment Phase 5 gems test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase5_gems.c AND NOT TARGET test_equipment_phase5_gems)
    add_executable(test_equipment_phase5_gems unit/test_equipment_phase5_gems.c)
    target_link_libraries(test_equipment_phase5_gems PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase5_gems PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase5_gems COMMAND test_equipment_phase5_gems)
    set_tests_properties(test_equipment_phase5_gems PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
endif()

    add_executable(test_equipment_phase5_enchant_reforge unit/test_equipment_phase5_enchant_reforge.c)
    target_link_libraries(test_equipment_phase5_enchant_reforge PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase5_enchant_reforge PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase5_enchant_reforge COMMAND test_equipment_phase5_enchant_reforge)
    set_tests_properties(test_equipment_phase5_enchant_reforge PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

    add_executable(test_equipment_phase5_protective_seal unit/test_equipment_phase5_protective_seal.c)
    target_link_libraries(test_equipment_phase5_protective_seal PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase5_protective_seal PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase5_protective_seal COMMAND test_equipment_phase5_protective_seal)
    set_tests_properties(test_equipment_phase5_protective_seal PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

    add_executable(test_equipment_phase6_proc_engine unit/test_equipment_phase6_proc_engine.c)
    target_link_libraries(test_equipment_phase6_proc_engine PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase6_proc_engine PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase6_proc_engine COMMAND test_equipment_phase6_proc_engine)
    set_tests_properties(test_equipment_phase6_proc_engine PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

    # Extended proc engine stacking/order/telemetry test (Phase 6.4-6.7)
    if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase6_proc_engine_extended.c AND NOT TARGET test_equipment_phase6_proc_engine_extended)
        add_executable(test_equipment_phase6_proc_engine_extended unit/test_equipment_phase6_proc_engine_extended.c)
        target_link_libraries(test_equipment_phase6_proc_engine_extended PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase6_proc_engine_extended PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase6_proc_engine_extended COMMAND test_equipment_phase6_proc_engine_extended)
        set_tests_properties(test_equipment_phase6_proc_engine_extended PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
    endif()
        add_executable(test_equipment_phase7_defensive unit/test_equipment_phase7_defensive.c)
        target_link_libraries(test_equipment_phase7_defensive PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase7_defensive PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase7_defensive COMMAND test_equipment_phase7_defensive)
        set_tests_properties(test_equipment_phase7_defensive PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        add_executable(test_equipment_phase7_block_affixes unit/test_equipment_phase7_block_affixes.c)
        target_link_libraries(test_equipment_phase7_block_affixes PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase7_block_affixes PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase7_block_affixes COMMAND test_equipment_phase7_block_affixes)
        set_tests_properties(test_equipment_phase7_block_affixes PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        add_executable(test_equipment_phase7_conversion_reflect unit/test_equipment_phase7_conversion_reflect.c)
        target_link_libraries(test_equipment_phase7_conversion_reflect PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase7_conversion_reflect PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase7_conversion_reflect COMMAND test_equipment_phase7_conversion_reflect)
        set_tests_properties(test_equipment_phase7_conversion_reflect PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        add_executable(test_equipment_phase7_affix_parsing_newstats unit/test_equipment_phase7_affix_parsing_newstats.c)
        target_link_libraries(test_equipment_phase7_affix_parsing_newstats PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase7_affix_parsing_newstats PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase7_affix_parsing_newstats COMMAND test_equipment_phase7_affix_parsing_newstats)
        set_tests_properties(test_equipment_phase7_affix_parsing_newstats PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        add_executable(test_equipment_phase7_reactive_shield unit/test_equipment_phase7_reactive_shield.c)
        target_link_libraries(test_equipment_phase7_reactive_shield PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase7_reactive_shield PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase7_reactive_shield COMMAND test_equipment_phase7_reactive_shield)
        set_tests_properties(test_equipment_phase7_reactive_shield PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        add_executable(test_equipment_phase8_durability_model unit/test_equipment_phase8_durability_model.c)
        target_link_libraries(test_equipment_phase8_durability_model PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase8_durability_model PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase8_durability_model COMMAND test_equipment_phase8_durability_model)
        set_tests_properties(test_equipment_phase8_durability_model PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        add_executable(test_equipment_phase8_repair_cost unit/test_equipment_phase8_repair_cost.c)
        target_link_libraries(test_equipment_phase8_repair_cost PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase8_repair_cost PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase8_repair_cost COMMAND test_equipment_phase8_repair_cost)
        set_tests_properties(test_equipment_phase8_repair_cost PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        add_executable(test_equipment_phase8_salvage_fracture unit/test_equipment_phase8_salvage_fracture.c)
        target_link_libraries(test_equipment_phase8_salvage_fracture PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_equipment_phase8_salvage_fracture PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase8_salvage_fracture COMMAND test_equipment_phase8_salvage_fracture)
        set_tests_properties(test_equipment_phase8_salvage_fracture PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 9 Loadout Optimization tests
        add_executable(test_equipment_phase9_loadout_opt unit/test_equipment_phase9_loadout_opt.c)
        target_link_libraries(test_equipment_phase9_loadout_opt PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase9_loadout_opt PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase9_loadout_opt COMMAND test_equipment_phase9_loadout_opt)
        set_tests_properties(test_equipment_phase9_loadout_opt PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 10.4 Quality metric test
        add_executable(test_equipment_phase10_quality unit/test_equipment_phase10_quality.c)
        target_link_libraries(test_equipment_phase10_quality PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase10_quality PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase10_quality COMMAND test_equipment_phase10_quality)
        set_tests_properties(test_equipment_phase10_quality PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 10.1-10.3 crafting pipeline test (upgrade stones, affix transfer, fusion)
        add_executable(test_equipment_phase10_crafting unit/test_equipment_phase10_crafting.c)
        target_link_libraries(test_equipment_phase10_crafting PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase10_crafting PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase10_crafting COMMAND test_equipment_phase10_crafting)
        set_tests_properties(test_equipment_phase10_crafting PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 10.5 crafting success chance scaling test (optional)
        add_executable(test_equipment_phase10_crafting_success unit/test_equipment_phase10_crafting_success.c)
        target_link_libraries(test_equipment_phase10_crafting_success PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase10_crafting_success PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase10_crafting_success COMMAND test_equipment_phase10_crafting_success)
        set_tests_properties(test_equipment_phase10_crafting_success PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 11 analytics snapshot & histogram test
        add_executable(test_equipment_phase11_analytics unit/test_equipment_phase11_analytics.c)
        target_link_libraries(test_equipment_phase11_analytics PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase11_analytics PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase11_analytics COMMAND test_equipment_phase11_analytics)
        set_tests_properties(test_equipment_phase11_analytics PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 11.5-11.6 balance analytics & A/B harness tests
        add_executable(test_equipment_phase11_balance unit/test_equipment_phase11_balance.c)
        target_link_libraries(test_equipment_phase11_balance PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase11_balance PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase11_balance COMMAND test_equipment_phase11_balance)
        set_tests_properties(test_equipment_phase11_balance PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 12 initial UI helpers (panel, layered tooltip, proc preview)
        add_executable(test_equipment_phase12_ui unit/test_equipment_phase12_ui.c)
        target_link_libraries(test_equipment_phase12_ui PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase12_ui PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase12_ui COMMAND test_equipment_phase12_ui)
        set_tests_properties(test_equipment_phase12_ui PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 13 equipment persistence & hash
        add_executable(test_equipment_phase13_persistence unit/test_equipment_phase13_persistence.c)
        target_link_libraries(test_equipment_phase13_persistence PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase13_persistence PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase13_persistence COMMAND test_equipment_phase13_persistence)
        set_tests_properties(test_equipment_phase13_persistence PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 18.4 stress combo test (max sockets + gems + set + runeword)
        if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase18_stress_combo.c AND NOT TARGET test_equipment_phase18_stress_combo)
            add_executable(test_equipment_phase18_stress_combo unit/test_equipment_phase18_stress_combo.c)
            target_link_libraries(test_equipment_phase18_stress_combo PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase18_stress_combo PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase18_stress_combo COMMAND test_equipment_phase18_stress_combo)
            set_tests_properties(test_equipment_phase18_stress_combo PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            set_tests_properties(test_equipment_phase18_stress_combo PROPERTIES LABELS "EQUIP_GATES;EQUIP_PHASE18")
        endif()

        # Phase 18.5 mutation / corruption robustness test
        if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase18_mutation.c AND NOT TARGET test_equipment_phase18_mutation)
            add_executable(test_equipment_phase18_mutation unit/test_equipment_phase18_mutation.c)
            target_link_libraries(test_equipment_phase18_mutation PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase18_mutation PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase18_mutation COMMAND test_equipment_phase18_mutation)
            set_tests_properties(test_equipment_phase18_mutation PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            set_tests_properties(test_equipment_phase18_mutation PROPERTIES LABELS "EQUIP_GATES;EQUIP_PHASE18")
        endif()

        # Phase 16.1 equipment item definition JSON tooling test
        add_executable(test_equipment_phase16_itemdefs_json unit/test_equipment_phase16_itemdefs_json.c)
        target_link_libraries(test_equipment_phase16_itemdefs_json PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase16_itemdefs_json PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase16_itemdefs_json COMMAND test_equipment_phase16_itemdefs_json)
        set_tests_properties(test_equipment_phase16_itemdefs_json PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 16.2 set builder + preview test
        add_executable(test_equipment_phase16_set_builder unit/test_equipment_phase16_set_builder.c)
        target_link_libraries(test_equipment_phase16_set_builder PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase16_set_builder PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase16_set_builder COMMAND test_equipment_phase16_set_builder)
        set_tests_properties(test_equipment_phase16_set_builder PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 16.3 proc designer JSON tooling test
        add_executable(test_equipment_phase16_proc_designer unit/test_equipment_phase16_proc_designer.c)
        target_link_libraries(test_equipment_phase16_proc_designer PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase16_proc_designer PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase16_proc_designer COMMAND test_equipment_phase16_proc_designer)
        set_tests_properties(test_equipment_phase16_proc_designer PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 16.4 runeword validator
        add_executable(test_equipment_phase16_runeword_validator unit/test_equipment_phase16_runeword_validator.c)
        target_link_libraries(test_equipment_phase16_runeword_validator PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase16_runeword_validator PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase16_runeword_validator COMMAND test_equipment_phase16_runeword_validator)
        set_tests_properties(test_equipment_phase16_runeword_validator PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 16.5 budget analyzer report generator
        add_executable(test_equipment_phase16_budget_analyzer unit/test_equipment_phase16_budget_analyzer.c)
        target_link_libraries(test_equipment_phase16_budget_analyzer PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase16_budget_analyzer PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase16_budget_analyzer COMMAND test_equipment_phase16_budget_analyzer)
        set_tests_properties(test_equipment_phase16_budget_analyzer PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 16.6 analyzer boundary + validator edge tests
        add_executable(test_equipment_phase16_analyzer_boundaries unit/test_equipment_phase16_analyzer_boundaries.c)
        target_link_libraries(test_equipment_phase16_analyzer_boundaries PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase16_analyzer_boundaries PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase16_analyzer_boundaries COMMAND test_equipment_phase16_analyzer_boundaries)
        set_tests_properties(test_equipment_phase16_analyzer_boundaries PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

        # Phase 17.1 schema docs exporter
        add_executable(test_equipment_phase17_schema_docs unit/test_equipment_phase17_schema_docs.c)
        target_link_libraries(test_equipment_phase17_schema_docs PRIVATE rogue_core)
        if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
            target_compile_definitions(test_equipment_phase17_schema_docs PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_equipment_phase17_schema_docs COMMAND test_equipment_phase17_schema_docs)
        set_tests_properties(test_equipment_phase17_schema_docs PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            # Phase 17.2 equipment hot reload test
            add_executable(test_equipment_phase17_hot_reload unit/test_equipment_phase17_hot_reload.c)
            target_link_libraries(test_equipment_phase17_hot_reload PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase17_hot_reload PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase17_hot_reload COMMAND test_equipment_phase17_hot_reload)
            set_tests_properties(test_equipment_phase17_hot_reload PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            # Phase 17.5 early: hot reload determinism hash test
            add_executable(test_equipment_phase17_hot_reload_hash unit/test_equipment_phase17_hot_reload_hash.c)
            target_link_libraries(test_equipment_phase17_hot_reload_hash PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase17_hot_reload_hash PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase17_hot_reload_hash COMMAND test_equipment_phase17_hot_reload_hash)
            set_tests_properties(test_equipment_phase17_hot_reload_hash PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            # Phase 17.3 sandbox scripting test
            add_executable(test_equipment_phase17_sandbox_script unit/test_equipment_phase17_sandbox_script.c)
            target_link_libraries(test_equipment_phase17_sandbox_script PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase17_sandbox_script PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase17_sandbox_script COMMAND test_equipment_phase17_sandbox_script)
            set_tests_properties(test_equipment_phase17_sandbox_script PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            # Phase 17.4 sets diff tool test
            add_executable(test_equipment_phase17_sets_diff unit/test_equipment_phase17_sets_diff.c)
            target_link_libraries(test_equipment_phase17_sets_diff PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase17_sets_diff PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase17_sets_diff COMMAND test_equipment_phase17_sets_diff)
            set_tests_properties(test_equipment_phase17_sets_diff PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

            # Phase 18.1 snapshot golden master test
            add_executable(test_equipment_phase18_snapshot unit/test_equipment_phase18_snapshot.c)
            target_link_libraries(test_equipment_phase18_snapshot PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase18_snapshot PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase18_snapshot COMMAND test_equipment_phase18_snapshot)
            set_tests_properties(test_equipment_phase18_snapshot PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            set_tests_properties(test_equipment_phase18_snapshot PROPERTIES LABELS "EQUIP_GATES;EQUIP_PHASE18")

            # Phase 18.2 fuzz equip/un-equip sequences test
            add_executable(test_equipment_phase18_fuzz unit/test_equipment_phase18_fuzz.c)
            target_link_libraries(test_equipment_phase18_fuzz PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase18_fuzz PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase18_fuzz COMMAND test_equipment_phase18_fuzz)
            set_tests_properties(test_equipment_phase18_fuzz PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            set_tests_properties(test_equipment_phase18_fuzz PROPERTIES LABELS "EQUIP_GATES;EQUIP_PHASE18")

            # Phase 18.3 statistical proc rate test
            add_executable(test_equipment_phase18_proc_stats unit/test_equipment_phase18_proc_stats.c)
            target_link_libraries(test_equipment_phase18_proc_stats PRIVATE rogue_core)
            if (SDL2_FOUND AND NOT ROGUE_HEADLESS)
                target_compile_definitions(test_equipment_phase18_proc_stats PRIVATE ROGUE_HAVE_SDL=1)
            endif()
            add_test(NAME test_equipment_phase18_proc_stats COMMAND test_equipment_phase18_proc_stats)
            set_tests_properties(test_equipment_phase18_proc_stats PROPERTIES WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})
            set_tests_properties(test_equipment_phase18_proc_stats PROPERTIES LABELS "EQUIP_GATES;EQUIP_PHASE18")

# UI Phase 6.2 bars + AP smoothing test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase6_bars_ap.c AND NOT TARGET test_ui_phase6_bars_ap)
    add_executable(test_ui_phase6_bars_ap unit/test_ui_phase6_bars_ap.c)
    target_link_libraries(test_ui_phase6_bars_ap PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase6_bars_ap PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase6_bars_ap COMMAND test_ui_phase6_bars_ap)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase13_slot_migration.c AND NOT TARGET test_equipment_phase13_slot_migration)
    add_executable(test_equipment_phase13_slot_migration unit/test_equipment_phase13_slot_migration.c)
    target_link_libraries(test_equipment_phase13_slot_migration PRIVATE rogue_core)
    if(ROGUE_BUILD_WITH_SDL2)
        target_compile_definitions(test_equipment_phase13_slot_migration PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase13_slot_migration COMMAND test_equipment_phase13_slot_migration)
endif()
# UI Phase 6.3 buff belt test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase6_buff_belt.c AND NOT TARGET test_ui_phase6_buff_belt)
    add_executable(test_ui_phase6_buff_belt unit/test_ui_phase6_buff_belt.c)
    target_link_libraries(test_ui_phase6_buff_belt PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase6_buff_belt PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase6_buff_belt COMMAND test_ui_phase6_buff_belt)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase6_minimap_metrics_alerts.c AND NOT TARGET test_ui_phase6_minimap_metrics_alerts)
    add_executable(test_ui_phase6_minimap_metrics_alerts unit/test_ui_phase6_minimap_metrics_alerts.c)
    target_link_libraries(test_ui_phase6_minimap_metrics_alerts PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase6_minimap_metrics_alerts PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase6_minimap_metrics_alerts COMMAND test_ui_phase6_minimap_metrics_alerts)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase7_theme.c AND NOT TARGET test_ui_phase7_theme)
    add_executable(test_ui_phase7_theme unit/test_ui_phase7_theme.c)
    target_link_libraries(test_ui_phase7_theme PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase7_theme PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase7_theme COMMAND test_ui_phase7_theme)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase7_accessibility.c AND NOT TARGET test_ui_phase7_accessibility)
    add_executable(test_ui_phase7_accessibility unit/test_ui_phase7_accessibility.c)
    target_link_libraries(test_ui_phase7_accessibility PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase7_accessibility PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase7_accessibility COMMAND test_ui_phase7_accessibility)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase8_animation.c AND NOT TARGET test_ui_phase8_animation)
    add_executable(test_ui_phase8_animation unit/test_ui_phase8_animation.c)
    target_link_libraries(test_ui_phase8_animation PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase8_animation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase8_animation COMMAND test_ui_phase8_animation)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase8_timeline.c AND NOT TARGET test_ui_phase8_timeline)
    add_executable(test_ui_phase8_timeline unit/test_ui_phase8_timeline.c)
    target_link_libraries(test_ui_phase8_timeline PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase8_timeline PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase8_timeline COMMAND test_ui_phase8_timeline)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase9_perf_virtual.c AND NOT TARGET test_ui_phase9_perf_virtual)
    add_executable(test_ui_phase9_perf_virtual unit/test_ui_phase9_perf_virtual.c)
    target_link_libraries(test_ui_phase9_perf_virtual PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase9_perf_virtual PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase9_perf_virtual COMMAND test_ui_phase9_perf_virtual)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase9_extended.c AND NOT TARGET test_ui_phase9_extended)
    add_executable(test_ui_phase9_extended unit/test_ui_phase9_extended.c)
    target_link_libraries(test_ui_phase9_extended PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase9_extended PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase9_extended COMMAND test_ui_phase9_extended)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase9_virtual_inventory.c AND NOT TARGET test_ui_phase9_virtual_inventory)
    add_executable(test_ui_phase9_virtual_inventory unit/test_ui_phase9_virtual_inventory.c)
    target_link_libraries(test_ui_phase9_virtual_inventory PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase9_virtual_inventory PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase9_virtual_inventory COMMAND test_ui_phase9_virtual_inventory)
endif()

# UI Phase 10.1 headless harness test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase10_headless_harness.c AND NOT TARGET test_ui_phase10_headless_harness)
    add_executable(test_ui_phase10_headless_harness unit/test_ui_phase10_headless_harness.c)
    target_link_libraries(test_ui_phase10_headless_harness PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase10_headless_harness PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase10_headless_harness COMMAND test_ui_phase10_headless_harness)
endif()

# World Generation Phase 1 foundation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase1_foundation.c AND NOT TARGET test_worldgen_phase1_foundation)
    add_executable(test_worldgen_phase1_foundation unit/test_worldgen_phase1_foundation.c)
    target_link_libraries(test_worldgen_phase1_foundation PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase1_foundation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase1_foundation COMMAND test_worldgen_phase1_foundation)
endif()

# World Generation Phase 2 macro layout test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase2_macro.c AND NOT TARGET test_worldgen_phase2_macro)
    add_executable(test_worldgen_phase2_macro unit/test_worldgen_phase2_macro.c)
    target_link_libraries(test_worldgen_phase2_macro PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase2_macro PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase2_macro COMMAND test_worldgen_phase2_macro)
endif()

# World Generation Phase 3 biome descriptor & registry test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase3_biome_descriptors.c AND NOT TARGET test_worldgen_phase3_biome_descriptors)
    add_executable(test_worldgen_phase3_biome_descriptors unit/test_worldgen_phase3_biome_descriptors.c)
    target_link_libraries(test_worldgen_phase3_biome_descriptors PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase3_biome_descriptors PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase3_biome_descriptors COMMAND test_worldgen_phase3_biome_descriptors)
endif()

# World Generation Phase 4 local terrain & caves test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase4_local_caves.c AND NOT TARGET test_worldgen_phase4_local_caves)
    add_executable(test_worldgen_phase4_local_caves unit/test_worldgen_phase4_local_caves.c)
    target_link_libraries(test_worldgen_phase4_local_caves PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase4_local_caves PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase4_local_caves COMMAND test_worldgen_phase4_local_caves)
endif()

# World Generation Phase 5 rivers & erosion detailing test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase5_rivers_erosion.c AND NOT TARGET test_worldgen_phase5_rivers_erosion)
    add_executable(test_worldgen_phase5_rivers_erosion unit/test_worldgen_phase5_rivers_erosion.c)
    target_link_libraries(test_worldgen_phase5_rivers_erosion PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase5_rivers_erosion PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase5_rivers_erosion COMMAND test_worldgen_phase5_rivers_erosion)
endif()

# World Generation Phase 6 structures & POIs test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase6_structures.c AND NOT TARGET test_worldgen_phase6_structures)
    add_executable(test_worldgen_phase6_structures unit/test_worldgen_phase6_structures.c)
    target_link_libraries(test_worldgen_phase6_structures PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase6_structures PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase6_structures COMMAND test_worldgen_phase6_structures)
endif()

# World Generation Phase 7 dungeon generator test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase7_dungeon.c AND NOT TARGET test_worldgen_phase7_dungeon)
    add_executable(test_worldgen_phase7_dungeon unit/test_worldgen_phase7_dungeon.c)
    target_link_libraries(test_worldgen_phase7_dungeon PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase7_dungeon PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase7_dungeon COMMAND test_worldgen_phase7_dungeon)
endif()

# World Generation Phase 8 fauna & spawn ecology test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase8_spawns.c AND NOT TARGET test_worldgen_phase8_spawns)
    add_executable(test_worldgen_phase8_spawns unit/test_worldgen_phase8_spawns.c)
    target_link_libraries(test_worldgen_phase8_spawns PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase8_spawns PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase8_spawns COMMAND test_worldgen_phase8_spawns)
endif()

# World Generation Phase 9 resource nodes test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase9_resources.c AND NOT TARGET test_worldgen_phase9_resources)
    add_executable(test_worldgen_phase9_resources unit/test_worldgen_phase9_resources.c)
    target_link_libraries(test_worldgen_phase9_resources PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase9_resources PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase9_resources COMMAND test_worldgen_phase9_resources)
endif()

# World Generation Phase 10 weather simulation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase10_weather.c AND NOT TARGET test_worldgen_phase10_weather)
    add_executable(test_worldgen_phase10_weather unit/test_worldgen_phase10_weather.c)
    target_link_libraries(test_worldgen_phase10_weather PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase10_weather PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase10_weather COMMAND test_worldgen_phase10_weather)
endif()

# World Generation Phase 11 streaming & caching test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase11_streaming.c AND NOT TARGET test_worldgen_phase11_streaming)
    add_executable(test_worldgen_phase11_streaming unit/test_worldgen_phase11_streaming.c)
    target_link_libraries(test_worldgen_phase11_streaming PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase11_streaming PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase11_streaming COMMAND test_worldgen_phase11_streaming)
endif()

# World Generation Phase 12 telemetry & analytics test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase12_telemetry.c AND NOT TARGET test_worldgen_phase12_telemetry)
    add_executable(test_worldgen_phase12_telemetry unit/test_worldgen_phase12_telemetry.c)
    target_link_libraries(test_worldgen_phase12_telemetry PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase12_telemetry PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase12_telemetry COMMAND test_worldgen_phase12_telemetry)
endif()

# World Generation Phase 13 modding & data extensibility test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase13_modding.c AND NOT TARGET test_worldgen_phase13_modding)
    add_executable(test_worldgen_phase13_modding unit/test_worldgen_phase13_modding.c)
    target_link_libraries(test_worldgen_phase13_modding PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase13_modding PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase13_modding COMMAND test_worldgen_phase13_modding)
endif()

# World Generation Phase 14 optimization & memory test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_worldgen_phase14_optimization.c AND NOT TARGET test_worldgen_phase14_optimization)
    add_executable(test_worldgen_phase14_optimization unit/test_worldgen_phase14_optimization.c)
    target_link_libraries(test_worldgen_phase14_optimization PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_worldgen_phase14_optimization PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_worldgen_phase14_optimization COMMAND test_worldgen_phase14_optimization)
endif()

# Phase 14.4 parallel optimization test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase14_parallel.c AND NOT TARGET test_equipment_phase14_parallel)
    add_executable(test_equipment_phase14_parallel unit/test_equipment_phase14_parallel.c)
    target_link_libraries(test_equipment_phase14_parallel PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase14_parallel PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase14_parallel COMMAND test_equipment_phase14_parallel)
endif()

# Phase 15 integrity & anti-duplication test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase15_integrity.c AND NOT TARGET test_equipment_phase15_integrity)
    add_executable(test_equipment_phase15_integrity unit/test_equipment_phase15_integrity.c)
    target_link_libraries(test_equipment_phase15_integrity PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase15_integrity PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase15_integrity COMMAND test_equipment_phase15_integrity)
endif()

# Phase 15.4–15.6 replay auditor & blacklist tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase15_replay_auditor.c AND NOT TARGET test_equipment_phase15_replay_auditor)
    add_executable(test_equipment_phase15_replay_auditor unit/test_equipment_phase15_replay_auditor.c)
    target_link_libraries(test_equipment_phase15_replay_auditor PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase15_replay_auditor PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase15_replay_auditor COMMAND test_equipment_phase15_replay_auditor)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase10_golden_theming.c AND NOT TARGET test_ui_phase10_golden_theming)
    add_executable(test_ui_phase10_golden_theming unit/test_ui_phase10_golden_theming.c)
    target_link_libraries(test_ui_phase10_golden_theming PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase10_golden_theming PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase10_golden_theming COMMAND test_ui_phase10_golden_theming)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase10_layout_fuzz.c AND NOT TARGET test_ui_phase10_layout_fuzz)
    add_executable(test_ui_phase10_layout_fuzz unit/test_ui_phase10_layout_fuzz.c)
    target_link_libraries(test_ui_phase10_layout_fuzz PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase10_layout_fuzz PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase10_layout_fuzz COMMAND test_ui_phase10_layout_fuzz)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase10_perf_smoke.c AND NOT TARGET test_ui_phase10_perf_smoke)
    add_executable(test_ui_phase10_perf_smoke unit/test_ui_phase10_perf_smoke.c)
    target_link_libraries(test_ui_phase10_perf_smoke PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase10_perf_smoke PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase10_perf_smoke COMMAND test_ui_phase10_perf_smoke)
endif()

# UI Phase 10.3 navigation traversal test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase10_navigation_traversal.c AND NOT TARGET test_ui_phase10_navigation_traversal)
    add_executable(test_ui_phase10_navigation_traversal unit/test_ui_phase10_navigation_traversal.c)
    target_link_libraries(test_ui_phase10_navigation_traversal PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase10_navigation_traversal PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase10_navigation_traversal COMMAND test_ui_phase10_navigation_traversal)
endif()

# UI Phase 11 docs & tooling test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase11_docs_tooling.c AND NOT TARGET test_ui_phase11_docs_tooling)
    add_executable(test_ui_phase11_docs_tooling unit/test_ui_phase11_docs_tooling.c)
    target_link_libraries(test_ui_phase11_docs_tooling PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase11_docs_tooling PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase11_docs_tooling COMMAND test_ui_phase11_docs_tooling)
endif()

# Loot API doc generator test (Itemsystem 23.5)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase23_api_doc.c AND NOT TARGET test_loot_phase23_api_doc)
    add_executable(test_loot_phase23_api_doc unit/test_loot_phase23_api_doc.c)
    target_link_libraries(test_loot_phase23_api_doc PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase23_api_doc PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase23_api_doc COMMAND test_loot_phase23_api_doc)
endif()

# Example config pack load test (Itemsystem 23.4)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase23_example_pack.c AND NOT TARGET test_loot_phase23_example_pack)
    add_executable(test_loot_phase23_example_pack unit/test_loot_phase23_example_pack.c)
    target_link_libraries(test_loot_phase23_example_pack PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase23_example_pack PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase23_example_pack COMMAND test_loot_phase23_example_pack)
endif()

# Doc path finder test (Cleanup 24.1 extension)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase23_doc_paths.c AND NOT TARGET test_loot_phase23_doc_paths)
    add_executable(test_loot_phase23_doc_paths unit/test_loot_phase23_doc_paths.c)
    target_link_libraries(test_loot_phase23_doc_paths PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase23_doc_paths PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase23_doc_paths COMMAND test_loot_phase23_doc_paths)
endif()
# Style guide doc presence test (Itemsystem 23.2)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase23_style_guide.c AND NOT TARGET test_loot_phase23_style_guide)
    add_executable(test_loot_phase23_style_guide unit/test_loot_phase23_style_guide.c)
    target_link_libraries(test_loot_phase23_style_guide PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase23_style_guide PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase23_style_guide COMMAND test_loot_phase23_style_guide)
endif()
# Loot tooltip comparison test (Itemsystem 12.6)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_tooltip_compare.c AND NOT TARGET test_loot_tooltip_compare)
    add_executable(test_loot_tooltip_compare unit/test_loot_tooltip_compare.c)
    target_link_libraries(test_loot_tooltip_compare PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_tooltip_compare PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_tooltip_compare COMMAND test_loot_tooltip_compare)
endif()
# Loot tooltip basic test (Itemsystem 12.5)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_tooltip_basic.c AND NOT TARGET test_loot_tooltip_basic)
    add_executable(test_loot_tooltip_basic unit/test_loot_tooltip_basic.c)
    target_link_libraries(test_loot_tooltip_basic PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_tooltip_basic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_tooltip_basic COMMAND test_loot_tooltip_basic)
endif()
# Minimap loot pings test (Itemsystem 12.4)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_minimap_loot_pings.c AND NOT TARGET test_minimap_loot_pings)
    add_executable(test_minimap_loot_pings unit/test_minimap_loot_pings.c)
    target_link_libraries(test_minimap_loot_pings PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_minimap_loot_pings PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_minimap_loot_pings COMMAND test_minimap_loot_pings)
endif()
file(GLOB UNIT_TESTS unit/test_*.c)

# Explicitly add AI Phase 1.1-1.3 behavior tree scaffolding test to avoid glob caching issues
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_behavior_tree.c AND NOT TARGET test_ai_behavior_tree)
    add_executable(test_ai_behavior_tree unit/test_ai_behavior_tree.c)
    target_link_libraries(test_ai_behavior_tree PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_behavior_tree PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_behavior_tree COMMAND test_ai_behavior_tree)
endif()

# AI Phase 1.4-1.7 scheduler/trace + RNG test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase1_scheduler_trace.c AND NOT TARGET test_ai_phase1_scheduler_trace)
    add_executable(test_ai_phase1_scheduler_trace unit/test_ai_phase1_scheduler_trace.c)
    target_link_libraries(test_ai_phase1_scheduler_trace PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase1_scheduler_trace PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase1_scheduler_trace COMMAND test_ai_phase1_scheduler_trace)
endif()

# AI Phase 2 blackboard extensions test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase2_blackboard.c AND NOT TARGET test_ai_phase2_blackboard)
    add_executable(test_ai_phase2_blackboard unit/test_ai_phase2_blackboard.c)
    target_link_libraries(test_ai_phase2_blackboard PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase2_blackboard PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase2_blackboard COMMAND test_ai_phase2_blackboard)
endif()

# AI Phase 3 perception system test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase3_perception.c AND NOT TARGET test_ai_phase3_perception)
    add_executable(test_ai_phase3_perception unit/test_ai_phase3_perception.c)
    target_link_libraries(test_ai_phase3_perception PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase3_perception PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase3_perception COMMAND test_ai_phase3_perception)
endif()

# AI Phase 4 node library test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase4_nodes.c AND NOT TARGET test_ai_phase4_nodes)
    add_executable(test_ai_phase4_nodes unit/test_ai_phase4_nodes.c)
    target_link_libraries(test_ai_phase4_nodes PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase4_nodes PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase4_nodes COMMAND test_ai_phase4_nodes)
endif()

# AI Phase 4 tactical/strafe test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase4_tactical.c AND NOT TARGET test_ai_phase4_tactical)
    add_executable(test_ai_phase4_tactical unit/test_ai_phase4_tactical.c)
    target_link_libraries(test_ai_phase4_tactical PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase4_tactical PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase4_tactical COMMAND test_ai_phase4_tactical)
endif()

# AI Phase 4 cover seek test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase4_cover.c AND NOT TARGET test_ai_phase4_cover)
    add_executable(test_ai_phase4_cover unit/test_ai_phase4_cover.c)
    target_link_libraries(test_ai_phase4_cover PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase4_cover PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase4_cover COMMAND test_ai_phase4_cover)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase4_retry.c AND NOT TARGET test_ai_phase4_retry)
    add_executable(test_ai_phase4_retry unit/test_ai_phase4_retry.c)
    target_link_libraries(test_ai_phase4_retry PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase4_retry PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase4_retry COMMAND test_ai_phase4_retry)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase5_enemy_integration.c AND NOT TARGET test_ai_phase5_enemy_integration)
    add_executable(test_ai_phase5_enemy_integration unit/test_ai_phase5_enemy_integration.c)
    target_link_libraries(test_ai_phase5_enemy_integration PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase5_enemy_integration PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase5_enemy_integration COMMAND test_ai_phase5_enemy_integration)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase9_budget.c AND NOT TARGET test_ai_phase9_budget)
    add_executable(test_ai_phase9_budget unit/test_ai_phase9_budget.c)
    target_link_libraries(test_ai_phase9_budget PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase9_budget PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase9_budget COMMAND test_ai_phase9_budget)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase9_incremental_lod.c AND NOT TARGET test_ai_phase9_incremental_lod)
    add_executable(test_ai_phase9_incremental_lod unit/test_ai_phase9_incremental_lod.c)
    target_link_libraries(test_ai_phase9_incremental_lod PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase9_incremental_lod PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase9_incremental_lod COMMAND test_ai_phase9_incremental_lod)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase9_agent_pool.c AND NOT TARGET test_ai_phase9_agent_pool)
    add_executable(test_ai_phase9_agent_pool unit/test_ai_phase9_agent_pool.c)
    target_link_libraries(test_ai_phase9_agent_pool PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase9_agent_pool PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase9_agent_pool COMMAND test_ai_phase9_agent_pool)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase10_debug.c AND NOT TARGET test_ai_phase10_debug)
    add_executable(test_ai_phase10_debug unit/test_ai_phase10_debug.c)
    target_link_libraries(test_ai_phase10_debug PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase10_debug PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase10_debug COMMAND test_ai_phase10_debug)
endif()

# AI Phase 11 tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase11_core_nodes.c AND NOT TARGET test_ai_phase11_core_nodes)
    add_executable(test_ai_phase11_core_nodes unit/test_ai_phase11_core_nodes.c)
    target_link_libraries(test_ai_phase11_core_nodes PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase11_core_nodes PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase11_core_nodes COMMAND test_ai_phase11_core_nodes)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase11_blackboard_fuzz.c AND NOT TARGET test_ai_phase11_blackboard_fuzz)
    add_executable(test_ai_phase11_blackboard_fuzz unit/test_ai_phase11_blackboard_fuzz.c)
    target_link_libraries(test_ai_phase11_blackboard_fuzz PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase11_blackboard_fuzz PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase11_blackboard_fuzz COMMAND test_ai_phase11_blackboard_fuzz)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase11_scenario.c AND NOT TARGET test_ai_phase11_scenario)
    add_executable(test_ai_phase11_scenario unit/test_ai_phase11_scenario.c)
    target_link_libraries(test_ai_phase11_scenario PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase11_scenario PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase11_scenario COMMAND test_ai_phase11_scenario)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase11_repro_trace.c AND NOT TARGET test_ai_phase11_repro_trace)
    add_executable(test_ai_phase11_repro_trace unit/test_ai_phase11_repro_trace.c)
    target_link_libraries(test_ai_phase11_repro_trace PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase11_repro_trace PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase11_repro_trace COMMAND test_ai_phase11_repro_trace)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase11_perf_guard.c AND NOT TARGET test_ai_phase11_perf_guard)
    add_executable(test_ai_phase11_perf_guard unit/test_ai_phase11_perf_guard.c)
    target_link_libraries(test_ai_phase11_perf_guard PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase11_perf_guard PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase11_perf_guard COMMAND test_ai_phase11_perf_guard)
endif()

# Filter out removed/legacy test filenames that may linger in generated projects
list(FILTER UNIT_TESTS EXCLUDE REGEX ".*test_skills_phase1_foundation.c$")

# Crafting system tests (11.2 - 11.6)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_crafting_basic.c AND NOT TARGET test_crafting_basic)
    add_executable(test_crafting_basic unit/test_crafting_basic.c)
    target_link_libraries(test_crafting_basic PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_crafting_basic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_crafting_basic COMMAND test_crafting_basic)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_reroll_affix.c AND NOT TARGET test_reroll_affix)
    add_executable(test_reroll_affix unit/test_reroll_affix.c)
    target_link_libraries(test_reroll_affix PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_reroll_affix PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_reroll_affix COMMAND test_reroll_affix)
endif()

# Loot filter tests (12.1 - 12.2)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_filter_basic.c AND NOT TARGET test_loot_filter_basic)
    add_executable(test_loot_filter_basic unit/test_loot_filter_basic.c)
    target_link_libraries(test_loot_filter_basic PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_filter_basic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_filter_basic COMMAND test_loot_filter_basic)
endif()

# Ensure dialogue tests are included (some CI environments cache glob results pre-file creation)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase0.c AND NOT TARGET test_dialogue_phase0)
    add_executable(test_dialogue_phase0 unit/test_dialogue_phase0.c)
    target_link_libraries(test_dialogue_phase0 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase0 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase0 COMMAND test_dialogue_phase0)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase1.c AND NOT TARGET test_dialogue_phase1)
    add_executable(test_dialogue_phase1 unit/test_dialogue_phase1.c)
    target_link_libraries(test_dialogue_phase1 PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase1 PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase1 COMMAND test_dialogue_phase1)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase2_tokens.c AND NOT TARGET test_dialogue_phase2_tokens)
    add_executable(test_dialogue_phase2_tokens unit/test_dialogue_phase2_tokens.c)
    target_link_libraries(test_dialogue_phase2_tokens PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase2_tokens PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase2_tokens COMMAND test_dialogue_phase2_tokens)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase3_effects.c AND NOT TARGET test_dialogue_phase3_effects)
    add_executable(test_dialogue_phase3_effects unit/test_dialogue_phase3_effects.c)
    target_link_libraries(test_dialogue_phase3_effects PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase3_effects PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase3_effects COMMAND test_dialogue_phase3_effects)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase4_persistence.c AND NOT TARGET test_dialogue_phase4_persistence)
    add_executable(test_dialogue_phase4_persistence unit/test_dialogue_phase4_persistence.c)
    target_link_libraries(test_dialogue_phase4_persistence PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase4_persistence PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase4_persistence COMMAND test_dialogue_phase4_persistence)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase5_localization.c AND NOT TARGET test_dialogue_phase5_localization)
    add_executable(test_dialogue_phase5_localization unit/test_dialogue_phase5_localization.c)
    target_link_libraries(test_dialogue_phase5_localization PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase5_localization PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase5_localization COMMAND test_dialogue_phase5_localization)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase6_typewriter.c AND NOT TARGET test_dialogue_phase6_typewriter)
    add_executable(test_dialogue_phase6_typewriter unit/test_dialogue_phase6_typewriter.c)
    target_link_libraries(test_dialogue_phase6_typewriter PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase6_typewriter PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase6_typewriter COMMAND test_dialogue_phase6_typewriter)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_phase7_analytics.c AND NOT TARGET test_dialogue_phase7_analytics)
    add_executable(test_dialogue_phase7_analytics unit/test_dialogue_phase7_analytics.c)
    target_link_libraries(test_dialogue_phase7_analytics PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_phase7_analytics PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_phase7_analytics COMMAND test_dialogue_phase7_analytics)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_dialogue_json.c AND NOT TARGET test_dialogue_json)
    add_executable(test_dialogue_json unit/test_dialogue_json.c)
    target_link_libraries(test_dialogue_json PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_dialogue_json PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_dialogue_json COMMAND test_dialogue_json)
endif()

# Phase 1 SaveManager roundtrip binary test (explicit add to avoid glob cache issues)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_roundtrip.c AND NOT TARGET test_save_roundtrip)
    add_executable(test_save_roundtrip unit/test_save_roundtrip.c)
    target_link_libraries(test_save_roundtrip PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_roundtrip PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_roundtrip COMMAND test_save_roundtrip)
endif()

# Autosave ring test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_autosave_ring.c AND NOT TARGET test_save_autosave_ring)
    add_executable(test_save_autosave_ring unit/test_save_autosave_ring.c)
    target_link_libraries(test_save_autosave_ring PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_autosave_ring PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_autosave_ring COMMAND test_save_autosave_ring)
endif()

# Component ordering determinism test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_ordering_determinism.c AND NOT TARGET test_save_ordering_determinism)
    add_executable(test_save_ordering_determinism unit/test_save_ordering_determinism.c)
    target_link_libraries(test_save_ordering_determinism PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_ordering_determinism PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_ordering_determinism COMMAND test_save_ordering_determinism)
endif()

# Migration chain test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_migration_chain.c AND NOT TARGET test_save_migration_chain)
    add_executable(test_save_migration_chain unit/test_save_migration_chain.c)
    target_link_libraries(test_save_migration_chain PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_migration_chain PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_migration_chain COMMAND test_save_migration_chain)
endif()

# Migration metrics test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_migration_metrics.c AND NOT TARGET test_save_migration_metrics)
    add_executable(test_save_migration_metrics unit/test_save_migration_metrics.c)
    target_link_libraries(test_save_migration_metrics PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_migration_metrics PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_migration_metrics COMMAND test_save_migration_metrics)
endif()

# JSON export test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_json_export.c AND NOT TARGET test_save_json_export)
    add_executable(test_save_json_export unit/test_save_json_export.c)
    target_link_libraries(test_save_json_export PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_json_export PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_json_export COMMAND test_save_json_export)
endif()

# Component reload test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_component_reload.c AND NOT TARGET test_save_component_reload)
    add_executable(test_save_component_reload unit/test_save_component_reload.c)
    target_link_libraries(test_save_component_reload PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_component_reload PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_component_reload COMMAND test_save_component_reload)
endif()

# TLV header layout test (v3+)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v3_tlv_headers.c AND NOT TARGET test_save_v3_tlv_headers)
    add_executable(test_save_v3_tlv_headers unit/test_save_v3_tlv_headers.c)
    target_link_libraries(test_save_v3_tlv_headers PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v3_tlv_headers PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v3_tlv_headers COMMAND test_save_v3_tlv_headers)
endif()

# Backward compatibility: load fabricated v2 under v3 build
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v2_backward_load.c AND NOT TARGET test_save_v2_backward_load)
    add_executable(test_save_v2_backward_load unit/test_save_v2_backward_load.c)
    target_link_libraries(test_save_v2_backward_load PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v2_backward_load PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v2_backward_load COMMAND test_save_v2_backward_load)
endif()

# Debug JSON toggle test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_debug_json_toggle.c AND NOT TARGET test_save_debug_json_toggle)
    add_executable(test_save_debug_json_toggle unit/test_save_debug_json_toggle.c)
    target_link_libraries(test_save_debug_json_toggle PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_debug_json_toggle PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_debug_json_toggle COMMAND test_save_debug_json_toggle)
endif()

# Varint counts (v4) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v4_varint_counts.c AND NOT TARGET test_save_v4_varint_counts)
    add_executable(test_save_v4_varint_counts unit/test_save_v4_varint_counts.c)
    target_link_libraries(test_save_v4_varint_counts PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v4_varint_counts PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v4_varint_counts COMMAND test_save_v4_varint_counts)
endif()

# String intern table (v5) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v5_strings.c AND NOT TARGET test_save_v5_strings)
    add_executable(test_save_v5_strings unit/test_save_v5_strings.c)
    target_link_libraries(test_save_v5_strings PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v5_strings PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v5_strings COMMAND test_save_v5_strings)
endif()

# Compression (v6) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v6_compression.c AND NOT TARGET test_save_v6_compression)
    add_executable(test_save_v6_compression unit/test_save_v6_compression.c)
    target_link_libraries(test_save_v6_compression PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v6_compression PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v6_compression COMMAND test_save_v6_compression)
endif()

# Integrity (v7) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v7_integrity.c AND NOT TARGET test_save_v7_integrity)
    add_executable(test_save_v7_integrity unit/test_save_v7_integrity.c)
    target_link_libraries(test_save_v7_integrity PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v7_integrity PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v7_integrity COMMAND test_save_v7_integrity)
endif()

# Replay hash (v8) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v8_replay_hash.c AND NOT TARGET test_save_v8_replay_hash)
    add_executable(test_save_v8_replay_hash unit/test_save_v8_replay_hash.c)
    target_link_libraries(test_save_v8_replay_hash PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v8_replay_hash PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v8_replay_hash COMMAND test_save_v8_replay_hash)
endif()

# Tamper + recovery (v8) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v8_tamper_recovery.c AND NOT TARGET test_save_v8_tamper_recovery)
    add_executable(test_save_v8_tamper_recovery unit/test_save_v8_tamper_recovery.c)
    target_link_libraries(test_save_v8_tamper_recovery PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v8_tamper_recovery PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v8_tamper_recovery COMMAND test_save_v8_tamper_recovery)
endif()

# Signature (v9) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_v9_signature.c AND NOT TARGET test_save_v9_signature)
    add_executable(test_save_v9_signature unit/test_save_v9_signature.c)
    target_link_libraries(test_save_v9_signature PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_v9_signature PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_v9_signature COMMAND test_save_v9_signature)
endif()

# Phase 15 inventory partial + backup test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_phase15_inventory_partial_backup.c AND NOT TARGET test_save_phase15_inventory_partial_backup)
    add_executable(test_save_phase15_inventory_partial_backup unit/test_save_phase15_inventory_partial_backup.c)
    target_link_libraries(test_save_phase15_inventory_partial_backup PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_phase15_inventory_partial_backup PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_phase15_inventory_partial_backup COMMAND test_save_phase15_inventory_partial_backup)
endif()

# Incremental save basic test (Phase 5)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_incremental_basic.c AND NOT TARGET test_save_incremental_basic)
    add_executable(test_save_incremental_basic unit/test_save_incremental_basic.c)
    target_link_libraries(test_save_incremental_basic PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_incremental_basic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_incremental_basic COMMAND test_save_incremental_basic)
endif()

# Phase 16 personal loot mode test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase16_personal_mode.c AND NOT TARGET test_loot_phase16_personal_mode)
    add_executable(test_loot_phase16_personal_mode unit/test_loot_phase16_personal_mode.c)
    target_link_libraries(test_loot_phase16_personal_mode PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase16_personal_mode PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase16_personal_mode COMMAND test_loot_phase16_personal_mode)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase16_need_greed_trade.c AND NOT TARGET test_loot_phase16_need_greed_trade)
    add_executable(test_loot_phase16_need_greed_trade unit/test_loot_phase16_need_greed_trade.c)
    target_link_libraries(test_loot_phase16_need_greed_trade PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase16_need_greed_trade PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase16_need_greed_trade COMMAND test_loot_phase16_need_greed_trade)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase17_perf.c AND NOT TARGET test_loot_phase17_perf)
    add_executable(test_loot_phase17_perf unit/test_loot_phase17_perf.c)
    target_link_libraries(test_loot_phase17_perf PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase17_perf PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase17_perf COMMAND test_loot_phase17_perf)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase17_index.c AND NOT TARGET test_loot_phase17_index)
    add_executable(test_loot_phase17_index unit/test_loot_phase17_index.c)
    target_link_libraries(test_loot_phase17_index PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase17_index PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase17_index COMMAND test_loot_phase17_index)
endif()

# Phase 17.5 diff metrics test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase17_5_diff.c AND NOT TARGET test_loot_phase17_5_diff)
    add_executable(test_loot_phase17_5_diff unit/test_loot_phase17_5_diff.c)
    target_link_libraries(test_loot_phase17_5_diff PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase17_5_diff PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase17_5_diff COMMAND test_loot_phase17_5_diff)
endif()

# Phase 18 analytics test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase18_analytics.c AND NOT TARGET test_loot_phase18_analytics)
    add_executable(test_loot_phase18_analytics unit/test_loot_phase18_analytics.c)
    target_link_libraries(test_loot_phase18_analytics PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase18_analytics PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase18_analytics COMMAND test_loot_phase18_analytics)
endif()

# Phase 18.3/18.4/18.5 advanced analytics (drift + summary + heatmap)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase18_3_4_5_advanced.c AND NOT TARGET test_loot_phase18_3_4_5_advanced)
    add_executable(test_loot_phase18_3_4_5_advanced unit/test_loot_phase18_3_4_5_advanced.c)
    target_link_libraries(test_loot_phase18_3_4_5_advanced PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase18_3_4_5_advanced PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase18_3_4_5_advanced COMMAND test_loot_phase18_3_4_5_advanced)
endif()

# Phase 19.1 pickup sounds test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase19_1_pickup_sounds.c AND NOT TARGET test_loot_phase19_1_pickup_sounds)
    add_executable(test_loot_phase19_1_pickup_sounds unit/test_loot_phase19_1_pickup_sounds.c)
    target_link_libraries(test_loot_phase19_1_pickup_sounds PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase19_1_pickup_sounds PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase19_1_pickup_sounds COMMAND test_loot_phase19_1_pickup_sounds)
endif()

# Phase 19.2–19.5 VFX (sparkle, beam, edge notifier, pulse) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase19_2_5_vfx.c AND NOT TARGET test_loot_phase19_2_5_vfx)
    add_executable(test_loot_phase19_2_5_vfx unit/test_loot_phase19_2_5_vfx.c)
    target_link_libraries(test_loot_phase19_2_5_vfx PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_loot_phase19_2_5_vfx PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase19_2_5_vfx COMMAND test_loot_phase19_2_5_vfx)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase20_1_fuzz_tables.c AND NOT TARGET test_loot_phase20_1_fuzz_tables)
    add_executable(test_loot_phase20_1_fuzz_tables unit/test_loot_phase20_1_fuzz_tables.c)
    target_link_libraries(test_loot_phase20_1_fuzz_tables PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase20_1_fuzz_tables PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase20_1_fuzz_tables COMMAND test_loot_phase20_1_fuzz_tables)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase20_2_3_stats_regression.c AND NOT TARGET test_loot_phase20_2_3_stats_regression)
    add_executable(test_loot_phase20_2_3_stats_regression unit/test_loot_phase20_2_3_stats_regression.c)
    target_link_libraries(test_loot_phase20_2_3_stats_regression PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase20_2_3_stats_regression PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase20_2_3_stats_regression COMMAND test_loot_phase20_2_3_stats_regression)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase20_4_persistence_roundtrip.c AND NOT TARGET test_loot_phase20_4_persistence_roundtrip)
    add_executable(test_loot_phase20_4_persistence_roundtrip unit/test_loot_phase20_4_persistence_roundtrip.c)
    target_link_libraries(test_loot_phase20_4_persistence_roundtrip PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase20_4_persistence_roundtrip PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase20_4_persistence_roundtrip COMMAND test_loot_phase20_4_persistence_roundtrip)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase20_5_merge_stress.c AND NOT TARGET test_loot_phase20_5_merge_stress)
    add_executable(test_loot_phase20_5_merge_stress unit/test_loot_phase20_5_merge_stress.c)
    target_link_libraries(test_loot_phase20_5_merge_stress PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase20_5_merge_stress PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase20_5_merge_stress COMMAND test_loot_phase20_5_merge_stress)
endif()

# Phase 21.2 tooling validation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_tooling_phase21_2_validation.c AND NOT TARGET test_loot_tooling_phase21_2_validation)
    add_executable(test_loot_tooling_phase21_2_validation unit/test_loot_tooling_phase21_2_validation.c)
    target_link_libraries(test_loot_tooling_phase21_2_validation PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_tooling_phase21_2_validation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_tooling_phase21_2_validation COMMAND test_loot_tooling_phase21_2_validation)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_tooling_phase21_1_convert.c AND NOT TARGET test_loot_tooling_phase21_1_convert)
    add_executable(test_loot_tooling_phase21_1_convert unit/test_loot_tooling_phase21_1_convert.c)
    target_link_libraries(test_loot_tooling_phase21_1_convert PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_tooling_phase21_1_convert PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_tooling_phase21_1_convert COMMAND test_loot_tooling_phase21_1_convert)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_tooling_phase21_3_affix_json.c AND NOT TARGET test_loot_tooling_phase21_3_affix_json)
    add_executable(test_loot_tooling_phase21_3_affix_json unit/test_loot_tooling_phase21_3_affix_json.c)
    target_link_libraries(test_loot_tooling_phase21_3_affix_json PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_tooling_phase21_3_affix_json PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_tooling_phase21_3_affix_json COMMAND test_loot_tooling_phase21_3_affix_json)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_tooling_phase21_4_rebalance.c AND NOT TARGET test_loot_tooling_phase21_4_rebalance)
    add_executable(test_loot_tooling_phase21_4_rebalance unit/test_loot_tooling_phase21_4_rebalance.c)
    target_link_libraries(test_loot_tooling_phase21_4_rebalance PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_tooling_phase21_4_rebalance PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_tooling_phase21_4_rebalance COMMAND test_loot_tooling_phase21_4_rebalance)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_tooling_phase21_5_sort.c AND NOT TARGET test_loot_tooling_phase21_5_sort)
    add_executable(test_loot_tooling_phase21_5_sort unit/test_loot_tooling_phase21_5_sort.c)
    target_link_libraries(test_loot_tooling_phase21_5_sort PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_tooling_phase21_5_sort PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_tooling_phase21_5_sort COMMAND test_loot_tooling_phase21_5_sort)
endif()

# Phase 22 Security / Cheat Resistance tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase22_security.c AND NOT TARGET test_loot_phase22_security)
    add_executable(test_loot_phase22_security unit/test_loot_phase22_security.c)
    target_link_libraries(test_loot_phase22_security PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase22_security PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase22_security COMMAND test_loot_phase22_security)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase22_server_anomaly.c AND NOT TARGET test_loot_phase22_server_anomaly)
    add_executable(test_loot_phase22_server_anomaly unit/test_loot_phase22_server_anomaly.c)
    target_link_libraries(test_loot_phase22_server_anomaly PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase22_server_anomaly PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase22_server_anomaly COMMAND test_loot_phase22_server_anomaly)
endif()

# Autosave scheduler test (Phase 6.1/6.3/6.4)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_autosave_scheduler.c AND NOT TARGET test_save_autosave_scheduler)
    add_executable(test_save_autosave_scheduler unit/test_save_autosave_scheduler.c)
    target_link_libraries(test_save_autosave_scheduler PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_autosave_scheduler PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_autosave_scheduler COMMAND test_save_autosave_scheduler)
endif()

# Autosave indicator/throttle test (Phase 6.5)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_autosave_indicator.c AND NOT TARGET test_save_autosave_indicator)
    add_executable(test_save_autosave_indicator unit/test_save_autosave_indicator.c)
    target_link_libraries(test_save_autosave_indicator PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_autosave_indicator PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_autosave_indicator COMMAND test_save_autosave_indicator)
endif()

# Phase 7.2/7.3 skill & buff extended state roundtrip test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_phase7_skill_buff_roundtrip.c AND NOT TARGET test_save_phase7_skill_buff_roundtrip)
    add_executable(test_save_phase7_skill_buff_roundtrip unit/test_save_phase7_skill_buff_roundtrip.c)
    target_link_libraries(test_save_phase7_skill_buff_roundtrip PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_phase7_skill_buff_roundtrip PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_phase7_skill_buff_roundtrip COMMAND test_save_phase7_skill_buff_roundtrip)
endif()

# Phase 7.1/7.7/7.8 player progression + analytics roundtrip test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_phase7_player_analytics_roundtrip.c AND NOT TARGET test_save_phase7_player_analytics_roundtrip)
    add_executable(test_save_phase7_player_analytics_roundtrip unit/test_save_phase7_player_analytics_roundtrip.c)
    target_link_libraries(test_save_phase7_player_analytics_roundtrip PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_phase7_player_analytics_roundtrip PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_phase7_player_analytics_roundtrip COMMAND test_save_phase7_player_analytics_roundtrip)
endif()

# Phase 7.5 vendor inventory roundtrip test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_phase7_vendor_inventory_roundtrip.c AND NOT TARGET test_save_phase7_vendor_inventory_roundtrip)
    add_executable(test_save_phase7_vendor_inventory_roundtrip unit/test_save_phase7_vendor_inventory_roundtrip.c)
    target_link_libraries(test_save_phase7_vendor_inventory_roundtrip PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_phase7_vendor_inventory_roundtrip PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_phase7_vendor_inventory_roundtrip COMMAND test_save_phase7_vendor_inventory_roundtrip)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_phase7_inventory_durability_roundtrip.c AND NOT TARGET test_save_phase7_inventory_durability_roundtrip)
    add_executable(test_save_phase7_inventory_durability_roundtrip unit/test_save_phase7_inventory_durability_roundtrip.c)
    target_link_libraries(test_save_phase7_inventory_durability_roundtrip PRIVATE rogue_core)
    if(ROGUE_HAVE_SDL)
        target_compile_definitions(test_save_phase7_inventory_durability_roundtrip PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_phase7_inventory_durability_roundtrip COMMAND test_save_phase7_inventory_durability_roundtrip)
endif()

# Basic save_manager smoke test (legacy simple test)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_save_manager.c AND NOT TARGET test_save_manager)
    add_executable(test_save_manager unit/test_save_manager.c)
    target_link_libraries(test_save_manager PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_save_manager PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_save_manager COMMAND test_save_manager)
endif()

# Explicitly add new maintainability phase M3.4 asset dependency graph test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_asset_dep.c AND NOT TARGET test_asset_dep)
    add_executable(test_asset_dep unit/test_asset_dep.c)
    target_link_libraries(test_asset_dep PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_asset_dep PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_asset_dep COMMAND test_asset_dep)
endif()

# Explicitly add new maintainability phase M3.5 projectile config hot reload test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_projectiles_config.c AND NOT TARGET test_projectiles_config)
    add_executable(test_projectiles_config unit/test_projectiles_config.c)
    target_link_libraries(test_projectiles_config PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_projectiles_config PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_projectiles_config COMMAND test_projectiles_config)
endif()

# Phase M3.6: directory-based hitbox loading test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hitbox_directory_load.c AND NOT TARGET test_hitbox_directory_load)
    add_executable(test_hitbox_directory_load unit/test_hitbox_directory_load.c)
    target_link_libraries(test_hitbox_directory_load PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hitbox_directory_load PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hitbox_directory_load COMMAND test_hitbox_directory_load)
endif()

# Phase M3.7: persistence version tag test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_persistence_versions.c AND NOT TARGET test_persistence_versions)
    add_executable(test_persistence_versions unit/test_persistence_versions.c)
    target_link_libraries(test_persistence_versions PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_persistence_versions PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_persistence_versions COMMAND test_persistence_versions)
endif()

# Phase M4.1: projectile config edge cases
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_projectiles_config_edge.c AND NOT TARGET test_projectiles_config_edge)
    add_executable(test_projectiles_config_edge unit/test_projectiles_config_edge.c)
    target_link_libraries(test_projectiles_config_edge PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_projectiles_config_edge PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_projectiles_config_edge COMMAND test_projectiles_config_edge)
endif()

# Phase M4.1: persistence edge cases
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_persistence_edge_cases.c AND NOT TARGET test_persistence_edge_cases)
    add_executable(test_persistence_edge_cases unit/test_persistence_edge_cases.c)
    target_link_libraries(test_persistence_edge_cases PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_persistence_edge_cases PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_persistence_edge_cases COMMAND test_persistence_edge_cases)
endif()

# Phase M4.2/M4.3 determinism & golden master test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_determinism_damage_events.c AND NOT TARGET test_determinism_damage_events)
    add_executable(test_determinism_damage_events unit/test_determinism_damage_events.c)
    target_link_libraries(test_determinism_damage_events PRIVATE rogue_core)
    target_compile_definitions(test_determinism_damage_events PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_determinism_damage_events PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_determinism_damage_events COMMAND test_determinism_damage_events)
endif()

# Phase M4.4 fuzz parsers (affix/persistence/kv)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_fuzz_parsers.c AND NOT TARGET test_fuzz_parsers)
    add_executable(test_fuzz_parsers unit/test_fuzz_parsers.c)
    target_link_libraries(test_fuzz_parsers PRIVATE rogue_core)
    target_compile_definitions(test_fuzz_parsers PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_fuzz_parsers PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_fuzz_parsers COMMAND test_fuzz_parsers)
endif()
# Explicitly add combat damage observer test (maintainability phase M2) to avoid glob cache issues
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_damage_observer.c AND NOT TARGET test_combat_damage_observer)
    add_executable(test_combat_damage_observer unit/test_combat_damage_observer.c)
    # Ensure C language (not C++)
    set_property(TARGET test_combat_damage_observer PROPERTY LINKER_LANGUAGE C)
    target_link_libraries(test_combat_damage_observer PRIVATE rogue_core)
    # Ensure observer feature macro visible so duplicate symbol guard engages correctly
    target_compile_definitions(test_combat_damage_observer PRIVATE ROGUE_FEATURE_COMBAT_OBSERVER=1)
    # Prevent SDL from redefining main to SDL_main when SDL headers transitively included
    target_compile_definitions(test_combat_damage_observer PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_damage_observer PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_damage_observer COMMAND test_combat_damage_observer)
endif()

# Ensure newly added directional combat test is always present (some generators cache GLOB results between incremental reconfigurations).
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_left_facing.c AND NOT TARGET test_combat_left_facing)
    add_executable(test_combat_left_facing unit/test_combat_left_facing.c)
    target_link_libraries(test_combat_left_facing PRIVATE rogue_core)
    target_compile_definitions(test_combat_left_facing PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_left_facing PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_left_facing COMMAND test_combat_left_facing)
endif()

# Explicitly add Phase 5.4/5.5 team filter & obstruction attenuation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase5_team_obstruction.c AND NOT TARGET test_combat_phase5_team_obstruction)
    add_executable(test_combat_phase5_team_obstruction unit/test_combat_phase5_team_obstruction.c)
    target_link_libraries(test_combat_phase5_team_obstruction PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase5_team_obstruction PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase5_team_obstruction PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase5_team_obstruction COMMAND test_combat_phase5_team_obstruction)
endif()

# Phase 5.6 lock-on acquisition/cycle/directional assist test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase5_lock_on.c AND NOT TARGET test_combat_phase5_lock_on)
    add_executable(test_combat_phase5_lock_on unit/test_combat_phase5_lock_on.c)
    target_link_libraries(test_combat_phase5_lock_on PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase5_lock_on PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase5_lock_on PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase5_lock_on COMMAND test_combat_phase5_lock_on)
endif()

# Phase 5.1 hitbox primitive test (explicit add to avoid glob cache issues)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase5_hitbox_primitives.c AND NOT TARGET test_combat_phase5_hitbox_primitives)
    add_executable(test_combat_phase5_hitbox_primitives unit/test_combat_phase5_hitbox_primitives.c)
    target_link_libraries(test_combat_phase5_hitbox_primitives PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase5_hitbox_primitives PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase5_hitbox_primitives COMMAND test_combat_phase5_hitbox_primitives)
endif()

# Phase 5.2/5.3 authoring + broadphase tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase5_hitbox_authoring_broadphase.c AND NOT TARGET test_combat_phase5_hitbox_authoring_broadphase)
    add_executable(test_combat_phase5_hitbox_authoring_broadphase unit/test_combat_phase5_hitbox_authoring_broadphase.c)
    target_link_libraries(test_combat_phase5_hitbox_authoring_broadphase PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase5_hitbox_authoring_broadphase PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase5_hitbox_authoring_broadphase COMMAND test_combat_phase5_hitbox_authoring_broadphase)
endif()

# Explicit heavy multi-window test (heavy_2 triple window validation)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_heavy_multi_window.c AND NOT TARGET test_combat_heavy_multi_window)
    add_executable(test_combat_heavy_multi_window unit/test_combat_heavy_multi_window.c)
    target_link_libraries(test_combat_heavy_multi_window PRIVATE rogue_core)
    target_compile_definitions(test_combat_heavy_multi_window PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_heavy_multi_window PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_heavy_multi_window COMMAND test_combat_heavy_multi_window)
endif()

# Explicit window boundary overlap test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_window_boundary.c AND NOT TARGET test_combat_window_boundary)
    add_executable(test_combat_window_boundary unit/test_combat_window_boundary.c)
    target_link_libraries(test_combat_window_boundary PRIVATE rogue_core)
    target_compile_definitions(test_combat_window_boundary PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_window_boundary PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_window_boundary COMMAND test_combat_window_boundary)
endif()

# Explicit player damage number spawn test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_damage_numbers_player.c AND NOT TARGET test_damage_numbers_player)
    add_executable(test_damage_numbers_player unit/test_damage_numbers_player.c)
    target_link_libraries(test_damage_numbers_player PRIVATE rogue_core)
    target_compile_definitions(test_damage_numbers_player PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_damage_numbers_player PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_damage_numbers_player COMMAND test_damage_numbers_player)
endif()

# UI Phase 5.4-5.7 advanced skillgraph test (filter/export/undo)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase5_skillgraph_advanced.c AND NOT TARGET test_ui_phase5_skillgraph_advanced)
    add_executable(test_ui_phase5_skillgraph_advanced unit/test_ui_phase5_skillgraph_advanced.c)
    target_link_libraries(test_ui_phase5_skillgraph_advanced PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase5_skillgraph_advanced PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase5_skillgraph_advanced COMMAND test_ui_phase5_skillgraph_advanced)
endif()

# Skills Phase 1.B talent graph skeleton test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_talents_phase1b_skeleton.c AND NOT TARGET test_talents_phase1b_skeleton)
    add_executable(test_talents_phase1b_skeleton unit/test_talents_phase1b_skeleton.c)
    target_link_libraries(test_talents_phase1b_skeleton PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_talents_phase1b_skeleton PRIVATE SDL2::SDL2)
        target_compile_definitions(test_talents_phase1b_skeleton PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_talents_phase1b_skeleton PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_talents_phase1b_skeleton COMMAND test_talents_phase1b_skeleton)
endif()

# Skills Phase 1.B respec + preview test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_talents_phase1b_respec_preview.c AND NOT TARGET test_talents_phase1b_respec_preview)
    add_executable(test_talents_phase1b_respec_preview unit/test_talents_phase1b_respec_preview.c)
    target_link_libraries(test_talents_phase1b_respec_preview PRIVATE rogue_core)
    if(TARGET SDL2::SDL2)
        target_link_libraries(test_talents_phase1b_respec_preview PRIVATE SDL2::SDL2)
        target_compile_definitions(test_talents_phase1b_respec_preview PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_talents_phase1b_respec_preview PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_talents_phase1b_respec_preview COMMAND test_talents_phase1b_respec_preview)
endif()

# UI Phase 4.4 context menu test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase4_context_menu.c AND NOT TARGET test_ui_phase4_context_menu)
    add_executable(test_ui_phase4_context_menu unit/test_ui_phase4_context_menu.c)
    target_link_libraries(test_ui_phase4_context_menu PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase4_context_menu PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase4_context_menu COMMAND test_ui_phase4_context_menu)
endif()

# UI Phase 4.5 stat delta preview test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase4_stat_preview.c AND NOT TARGET test_ui_phase4_stat_preview)
    add_executable(test_ui_phase4_stat_preview unit/test_ui_phase4_stat_preview.c)
    target_link_libraries(test_ui_phase4_stat_preview PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase4_stat_preview PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase4_stat_preview COMMAND test_ui_phase4_stat_preview)
endif()

# UI Phase 4.6 rarity color theming test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase4_rarity_colors.c AND NOT TARGET test_ui_phase4_rarity_colors)
    add_executable(test_ui_phase4_rarity_colors unit/test_ui_phase4_rarity_colors.c)
    target_link_libraries(test_ui_phase4_rarity_colors PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase4_rarity_colors PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase4_rarity_colors COMMAND test_ui_phase4_rarity_colors)
endif()

# UI Phase 4.7 vendor restock timer fraction test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase4_vendor_restock.c AND NOT TARGET test_ui_phase4_vendor_restock)
    add_executable(test_ui_phase4_vendor_restock unit/test_ui_phase4_vendor_restock.c)
    target_link_libraries(test_ui_phase4_vendor_restock PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase4_vendor_restock PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase4_vendor_restock COMMAND test_ui_phase4_vendor_restock)
endif()

# UI Phase 4.8 vendor transaction confirmation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase4_vendor_transaction.c AND NOT TARGET test_ui_phase4_vendor_transaction)
    add_executable(test_ui_phase4_vendor_transaction unit/test_ui_phase4_vendor_transaction.c)
    target_link_libraries(test_ui_phase4_vendor_transaction PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase4_vendor_transaction PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase4_vendor_transaction COMMAND test_ui_phase4_vendor_transaction)
endif()

# UI Phase 4.9 durability threshold bucket test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase4_durability_thresholds.c AND NOT TARGET test_ui_phase4_durability_thresholds)
    add_executable(test_ui_phase4_durability_thresholds unit/test_ui_phase4_durability_thresholds.c)
    target_link_libraries(test_ui_phase4_durability_thresholds PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase4_durability_thresholds PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase4_durability_thresholds COMMAND test_ui_phase4_durability_thresholds)
endif()

# UI Phase 4.10 radial selector test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase4_radial_selector.c AND NOT TARGET test_ui_phase4_radial_selector)
    add_executable(test_ui_phase4_radial_selector unit/test_ui_phase4_radial_selector.c)
    target_link_libraries(test_ui_phase4_radial_selector PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase4_radial_selector PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase4_radial_selector COMMAND test_ui_phase4_radial_selector)
endif()

# UI Phase 5.1 skill graph quadtree culling & layering test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase5_skillgraph.c AND NOT TARGET test_ui_phase5_skillgraph)
    add_executable(test_ui_phase5_skillgraph unit/test_ui_phase5_skillgraph.c)
    target_link_libraries(test_ui_phase5_skillgraph PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase5_skillgraph PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase5_skillgraph COMMAND test_ui_phase5_skillgraph)
endif()

# UI Phase 6.1 HUD layout spec test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase6_hud_layout.c AND NOT TARGET test_ui_phase6_hud_layout)
    add_executable(test_ui_phase6_hud_layout unit/test_ui_phase6_hud_layout.c)
    target_link_libraries(test_ui_phase6_hud_layout PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase6_hud_layout PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase6_hud_layout COMMAND test_ui_phase6_hud_layout)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_skill_maze_generation.c AND NOT TARGET test_ui_skill_maze_generation)
    add_executable(test_ui_skill_maze_generation unit/test_ui_skill_maze_generation.c)
    target_link_libraries(test_ui_skill_maze_generation PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_skill_maze_generation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_skill_maze_generation COMMAND test_ui_skill_maze_generation)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase5_skillgraph_anim.c AND NOT TARGET test_ui_phase5_skillgraph_anim)
    add_executable(test_ui_phase5_skillgraph_anim unit/test_ui_phase5_skillgraph_anim.c)
    target_link_libraries(test_ui_phase5_skillgraph_anim PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase5_skillgraph_anim PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase5_skillgraph_anim COMMAND test_ui_phase5_skillgraph_anim)
endif()

# Explicitly add vendor restock rotation test (10.3)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_restock.c AND NOT TARGET test_vendor_restock)
    add_executable(test_vendor_restock unit/test_vendor_restock.c)
    target_link_libraries(test_vendor_restock PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vendor_restock PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_restock COMMAND test_vendor_restock)
endif()

# Vendor System Phase 0 valuation & catalog test (0.1-0.3,0.5)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase0_value.c AND NOT TARGET test_vendor_phase0_value)
    add_executable(test_vendor_phase0_value unit/test_vendor_phase0_value.c)
    target_link_libraries(test_vendor_phase0_value PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vendor_phase0_value PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase0_value COMMAND test_vendor_phase0_value)
endif()

# Vendor System Phase 0 inflow baseline simulation test (0.4)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase0_inflow.c AND NOT TARGET test_vendor_phase0_inflow)
    add_executable(test_vendor_phase0_inflow unit/test_vendor_phase0_inflow.c)
    target_link_libraries(test_vendor_phase0_inflow PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vendor_phase0_inflow PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase0_inflow COMMAND test_vendor_phase0_inflow)
endif()

# Vendor System Phase 1 registry test (1.1-1.3)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase1_registry.c AND NOT TARGET test_vendor_phase1_registry)
    add_executable(test_vendor_phase1_registry unit/test_vendor_phase1_registry.c)
    target_link_libraries(test_vendor_phase1_registry PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vendor_phase1_registry PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase1_registry COMMAND test_vendor_phase1_registry)
endif()

# Vendor System Phase 1 negotiation & rule tests (1.4 + remainder 1.5)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vendor_phase1_negotiation.c AND NOT TARGET test_vendor_phase1_negotiation)
    add_executable(test_vendor_phase1_negotiation unit/test_vendor_phase1_negotiation.c)
    target_link_libraries(test_vendor_phase1_negotiation PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vendor_phase1_negotiation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vendor_phase1_negotiation COMMAND test_vendor_phase1_negotiation)
endif()

# Explicitly add loot phase 9 drop rates test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase9_drop_rates.c AND NOT TARGET test_loot_phase9_drop_rates)
    add_executable(test_loot_phase9_drop_rates unit/test_loot_phase9_drop_rates.c)
    target_link_libraries(test_loot_phase9_drop_rates PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase9_drop_rates PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase9_drop_rates COMMAND test_loot_phase9_drop_rates)
endif()

# Explicitly add loot phase 9 adaptive weighting test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase9_adaptive.c AND NOT TARGET test_loot_phase9_adaptive)
    add_executable(test_loot_phase9_adaptive unit/test_loot_phase9_adaptive.c)
    target_link_libraries(test_loot_phase9_adaptive PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase9_adaptive PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase9_adaptive COMMAND test_loot_phase9_adaptive)
endif()

# Explicitly add loot phase 9 preference learning test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase9_preference.c AND NOT TARGET test_loot_phase9_preference)
    add_executable(test_loot_phase9_preference unit/test_loot_phase9_preference.c)
    target_link_libraries(test_loot_phase9_preference PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase9_preference PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase9_preference COMMAND test_loot_phase9_preference)
endif()

# Explicitly add loot phase 9 pity acceleration test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase9_pity.c AND NOT TARGET test_loot_phase9_pity)
    add_executable(test_loot_phase9_pity unit/test_loot_phase9_pity.c)
    target_link_libraries(test_loot_phase9_pity PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase9_pity PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase9_pity COMMAND test_loot_phase9_pity)
endif()

# Explicitly add loot phase 9 tuning console test (9.6)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase9_tuning_console.c AND NOT TARGET test_loot_phase9_tuning_console)
    add_executable(test_loot_phase9_tuning_console unit/test_loot_phase9_tuning_console.c)
    target_link_libraries(test_loot_phase9_tuning_console PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase9_tuning_console PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase9_tuning_console COMMAND test_loot_phase9_tuning_console)
endif()

# Explicitly add generation quality test (ensure picked up even if glob cache stale)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase8_generation_quality.c AND NOT TARGET test_loot_phase8_generation_quality)

    add_executable(test_loot_phase8_generation_quality unit/test_loot_phase8_generation_quality.c)
    target_link_libraries(test_loot_phase8_generation_quality PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase8_generation_quality PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase8_generation_quality COMMAND test_loot_phase8_generation_quality)
endif()

# Explicitly add skill cast/channel test (Phase 1.3/1.4 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_skill_cast_and_channel.c AND NOT TARGET test_skill_cast_and_channel)
    add_executable(test_skill_cast_and_channel unit/test_skill_cast_and_channel.c)
    target_link_libraries(test_skill_cast_and_channel PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_skill_cast_and_channel PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_skill_cast_and_channel COMMAND test_skill_cast_and_channel)
endif()

# Explicitly add channel ticks scheduler test (Phase 1A.5 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_channel_ticks_and_buffer.c AND NOT TARGET test_channel_ticks_and_buffer)
    add_executable(test_channel_ticks_and_buffer unit/test_channel_ticks_and_buffer.c)
    target_link_libraries(test_channel_ticks_and_buffer PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_channel_ticks_and_buffer PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_channel_ticks_and_buffer COMMAND test_channel_ticks_and_buffer)
endif()

# Explicitly add input buffering cast test (Phase 1A.1 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_input_buffer_cast.c AND NOT TARGET test_input_buffer_cast)
    add_executable(test_input_buffer_cast unit/test_input_buffer_cast.c)
    target_link_libraries(test_input_buffer_cast PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_input_buffer_cast PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_input_buffer_cast COMMAND test_input_buffer_cast)
endif()

# Explicitly add Phase 1A buffer + weave + combo test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_skills_phase1a_buffer_weave_combo.c AND NOT TARGET test_skills_phase1a_buffer_weave_combo)
    add_executable(test_skills_phase1a_buffer_weave_combo unit/test_skills_phase1a_buffer_weave_combo.c)
    target_link_libraries(test_skills_phase1a_buffer_weave_combo PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_skills_phase1a_buffer_weave_combo PRIVATE ROGUE_HAVE_SDL=1 SDL_MAIN_HANDLED=1)
    else()
        target_compile_definitions(test_skills_phase1a_buffer_weave_combo PRIVATE SDL_MAIN_HANDLED=1)
    endif()
    add_test(NAME test_skills_phase1a_buffer_weave_combo COMMAND test_skills_phase1a_buffer_weave_combo)
endif()

# Explicitly add haste cast speed test (Phase 1A.3 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_haste_cast_speed.c AND NOT TARGET test_haste_cast_speed)
    add_executable(test_haste_cast_speed unit/test_haste_cast_speed.c)
    target_link_libraries(test_haste_cast_speed PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_haste_cast_speed PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_haste_cast_speed COMMAND test_haste_cast_speed)
endif()

# Phase 6.1 & 6.3 charge + dodge test (explicit)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase6_charge_and_dodge.c AND NOT TARGET test_combat_phase6_charge_and_dodge)
    add_executable(test_combat_phase6_charge_and_dodge unit/test_combat_phase6_charge_and_dodge.c)
    target_link_libraries(test_combat_phase6_charge_and_dodge PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase6_charge_and_dodge PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase6_charge_and_dodge PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase6_charge_and_dodge COMMAND test_combat_phase6_charge_and_dodge)
endif()

# Phase 6.4/6.5/6.6 backstab + parry + riposte basic test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase6_parry_backstab_riposte.c AND NOT TARGET test_combat_phase6_parry_backstab_riposte)
    add_executable(test_combat_phase6_parry_backstab_riposte unit/test_combat_phase6_parry_backstab_riposte.c)
    target_link_libraries(test_combat_phase6_parry_backstab_riposte PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase6_parry_backstab_riposte PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase6_parry_backstab_riposte PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase6_parry_backstab_riposte COMMAND test_combat_phase6_parry_backstab_riposte)
endif()

# Phase 6.2 / 6.6 / 6.7 aerial, guard break, deflect placeholder test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase6_aerial_deflect_guardbreak.c AND NOT TARGET test_combat_phase6_aerial_deflect_guardbreak)
    add_executable(test_combat_phase6_aerial_deflect_guardbreak unit/test_combat_phase6_aerial_deflect_guardbreak.c)
    target_link_libraries(test_combat_phase6_aerial_deflect_guardbreak PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase6_aerial_deflect_guardbreak PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase6_aerial_deflect_guardbreak PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase6_aerial_deflect_guardbreak COMMAND test_combat_phase6_aerial_deflect_guardbreak)
endif()

# Phase 6 extended multipliers test (backstab + guard-break + riposte damage application)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase6_backstab_guardbreak_riposte_bonus.c AND NOT TARGET test_combat_phase6_backstab_guardbreak_riposte_bonus)
    add_executable(test_combat_phase6_backstab_guardbreak_riposte_bonus unit/test_combat_phase6_backstab_guardbreak_riposte_bonus.c)
    target_link_libraries(test_combat_phase6_backstab_guardbreak_riposte_bonus PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase6_backstab_guardbreak_riposte_bonus PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase6_backstab_guardbreak_riposte_bonus PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase6_backstab_guardbreak_riposte_bonus COMMAND test_combat_phase6_backstab_guardbreak_riposte_bonus)
endif()

# Phase 7.1/7.3/7.5 weapon + stance + familiarity basic test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_weapon_stance_familiarity.c AND NOT TARGET test_combat_phase7_weapon_stance_familiarity)
    add_executable(test_combat_phase7_weapon_stance_familiarity unit/test_combat_phase7_weapon_stance_familiarity.c)
    target_link_libraries(test_combat_phase7_weapon_stance_familiarity PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase7_weapon_stance_familiarity PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase7_weapon_stance_familiarity PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase7_weapon_stance_familiarity COMMAND test_combat_phase7_weapon_stance_familiarity)
endif()

# Phase 7.4 / 7.6 infusions + durability scalar test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_infusions_durability.c AND NOT TARGET test_combat_phase7_infusions_durability)
    add_executable(test_combat_phase7_infusions_durability unit/test_combat_phase7_infusions_durability.c)
    target_link_libraries(test_combat_phase7_infusions_durability PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase7_infusions_durability PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase7_infusions_durability PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase7_infusions_durability COMMAND test_combat_phase7_infusions_durability)
endif()

# Phase 7.2 armor weight classes test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_armor_weight_classes.c AND NOT TARGET test_combat_phase7_armor_weight_classes)
    add_executable(test_combat_phase7_armor_weight_classes unit/test_combat_phase7_armor_weight_classes.c)
    target_link_libraries(test_combat_phase7_armor_weight_classes PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase7_armor_weight_classes PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase7_armor_weight_classes PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase7_armor_weight_classes COMMAND test_combat_phase7_armor_weight_classes)
endif()

# Phase 7.7 infusion damage redistribution & mitigation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_infusion_split_events.c AND NOT TARGET test_combat_phase7_infusion_split_events)
    add_executable(test_combat_phase7_infusion_split_events unit/test_combat_phase7_infusion_split_events.c)
    target_link_libraries(test_combat_phase7_infusion_split_events PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase7_infusion_split_events PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase7_infusion_split_events PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase7_infusion_split_events COMMAND test_combat_phase7_infusion_split_events)
endif()

    # Phase 7.8 stance frame timing test
    if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_stance_frame_timing.c AND NOT TARGET test_combat_phase7_stance_frame_timing)
        add_executable(test_combat_phase7_stance_frame_timing unit/test_combat_phase7_stance_frame_timing.c)
        target_link_libraries(test_combat_phase7_stance_frame_timing PRIVATE rogue_core)
        target_compile_definitions(test_combat_phase7_stance_frame_timing PRIVATE TEST_COMBAT_PERMISSIVE=1)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_combat_phase7_stance_frame_timing PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_combat_phase7_stance_frame_timing COMMAND test_combat_phase7_stance_frame_timing)
    endif()

    # Phase 7.7 familiarity cap boundary test
    if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_familiarity_cap.c AND NOT TARGET test_combat_phase7_familiarity_cap)
        add_executable(test_combat_phase7_familiarity_cap unit/test_combat_phase7_familiarity_cap.c)
        target_link_libraries(test_combat_phase7_familiarity_cap PRIVATE rogue_core)
        target_compile_definitions(test_combat_phase7_familiarity_cap PRIVATE TEST_COMBAT_PERMISSIVE=1)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_combat_phase7_familiarity_cap PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_combat_phase7_familiarity_cap COMMAND test_combat_phase7_familiarity_cap)
    endif()

    # Phase 7.7 encumbrance mobility curve (tier thresholds) test
    if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_encumbrance_mobility_curve.c AND NOT TARGET test_combat_phase7_encumbrance_mobility_curve)
        add_executable(test_combat_phase7_encumbrance_mobility_curve unit/test_combat_phase7_encumbrance_mobility_curve.c)
        target_link_libraries(test_combat_phase7_encumbrance_mobility_curve PRIVATE rogue_core)
        target_compile_definitions(test_combat_phase7_encumbrance_mobility_curve PRIVATE TEST_COMBAT_PERMISSIVE=1)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_combat_phase7_encumbrance_mobility_curve PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_combat_phase7_encumbrance_mobility_curve COMMAND test_combat_phase7_encumbrance_mobility_curve)
    endif()

    # Phase 7.7 per-component damage event emission test
    if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase7_damage_event_components.c AND NOT TARGET test_combat_phase7_damage_event_components)
        add_executable(test_combat_phase7_damage_event_components unit/test_combat_phase7_damage_event_components.c)
        target_link_libraries(test_combat_phase7_damage_event_components PRIVATE rogue_core)
        target_compile_definitions(test_combat_phase7_damage_event_components PRIVATE TEST_COMBAT_PERMISSIVE=1)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_combat_phase7_damage_event_components PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_combat_phase7_damage_event_components COMMAND test_combat_phase7_damage_event_components)
    endif()

    # Execution flag behavior: low-health and overkill triggers
    if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_execution.c AND NOT TARGET test_combat_execution)
        add_executable(test_combat_execution unit/test_combat_execution.c)
        target_link_libraries(test_combat_execution PRIVATE rogue_core)
        target_compile_definitions(test_combat_execution PRIVATE SDL_MAIN_HANDLED=1)
        target_compile_definitions(test_combat_execution PRIVATE TEST_COMBAT_PERMISSIVE=1)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_combat_execution PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_combat_execution COMMAND test_combat_execution)
    endif()

# Explicitly add cast weaving & early cancel test (Phase 1A.2/1A.4 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_cast_weave_and_cancel.c AND NOT TARGET test_cast_weave_and_cancel)
    add_executable(test_cast_weave_and_cancel unit/test_cast_weave_and_cancel.c)
    target_link_libraries(test_cast_weave_and_cancel PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_cast_weave_and_cancel PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_cast_weave_and_cancel COMMAND test_cast_weave_and_cancel)
endif()

# AI Phase 1.8+ tests
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase1_8_plus.c AND NOT TARGET test_ai_phase1_8_plus)
    add_executable(test_ai_phase1_8_plus unit/test_ai_phase1_8_plus.c)
    target_link_libraries(test_ai_phase1_8_plus PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase1_8_plus PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase1_8_plus COMMAND test_ai_phase1_8_plus)
endif()

# Loot mask integration test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_hit_mask_integration.c AND NOT TARGET test_hit_mask_integration)
    add_executable(test_hit_mask_integration unit/test_hit_mask_integration.c)
    target_link_libraries(test_hit_mask_integration PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_hit_mask_integration PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_hit_mask_integration COMMAND test_hit_mask_integration)
endif()

foreach(ut ${UNIT_TESTS})
    get_filename_component(name ${ut} NAME_WE)
    if(TARGET ${name})
        # Skip if already added explicitly above
        continue()
    endif()
    add_executable(${name} ${ut})
    target_link_libraries(${name} PRIVATE rogue_core)
    # Prevent SDL from redefining main to SDL_main when SDL headers transitively included
    target_compile_definitions(${name} PRIVATE SDL_MAIN_HANDLED=1)
    target_compile_definitions(${name} PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(${name} PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME ${name} COMMAND ${name})
endforeach()

# Explicitly add vegetation collision test (ensure included even if glob cache stale)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vegetation_collision.c AND NOT TARGET test_vegetation_collision)
    add_executable(test_vegetation_collision unit/test_vegetation_collision.c)
    target_link_libraries(test_vegetation_collision PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vegetation_collision PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vegetation_collision COMMAND test_vegetation_collision)
endif()

# Explicitly add vegetation canopy block test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vegetation_canopy_block.c AND NOT TARGET test_vegetation_canopy_block)
    add_executable(test_vegetation_canopy_block unit/test_vegetation_canopy_block.c)
    target_link_libraries(test_vegetation_canopy_block PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vegetation_canopy_block PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vegetation_canopy_block COMMAND test_vegetation_canopy_block)
endif()

# Explicitly add vegetation trunk collision behavioural test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_vegetation_trunk_collision.c AND NOT TARGET test_vegetation_trunk_collision)
    add_executable(test_vegetation_trunk_collision unit/test_vegetation_trunk_collision.c)
    target_link_libraries(test_vegetation_trunk_collision PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_vegetation_trunk_collision PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_vegetation_trunk_collision COMMAND test_vegetation_trunk_collision)
endif()

# Explicitly add mob collision test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_mob_collision.c AND NOT TARGET test_mob_collision)
    add_executable(test_mob_collision unit/test_mob_collision.c)
    target_link_libraries(test_mob_collision PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_mob_collision PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_mob_collision COMMAND test_mob_collision)
endif()

# Explicitly add navigation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_navigation.c AND NOT TARGET test_navigation)
    add_executable(test_navigation unit/test_navigation.c)
    target_link_libraries(test_navigation PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_navigation PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_navigation COMMAND test_navigation)
endif()

# AI Phase 5 path smoothing and stuck detection scaffold test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase5_path_smoothing_and_stuck.c AND NOT TARGET test_ai_phase5_path_smoothing_and_stuck)
    add_executable(test_ai_phase5_path_smoothing_and_stuck unit/test_ai_phase5_path_smoothing_and_stuck.c)
    target_link_libraries(test_ai_phase5_path_smoothing_and_stuck PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase5_path_smoothing_and_stuck PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase5_path_smoothing_and_stuck PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase5_path_smoothing_and_stuck COMMAND test_ai_phase5_path_smoothing_and_stuck)
endif()

# AI Phase 5 stuck detection decorator focused test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ai_phase5_stuck_detect.c AND NOT TARGET test_ai_phase5_stuck_detect)
    add_executable(test_ai_phase5_stuck_detect unit/test_ai_phase5_stuck_detect.c)
    target_link_libraries(test_ai_phase5_stuck_detect PRIVATE rogue_core)
    target_compile_definitions(test_ai_phase5_stuck_detect PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ai_phase5_stuck_detect PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ai_phase5_stuck_detect COMMAND test_ai_phase5_stuck_detect)
endif()

# Explicitly add combat block cancel test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_block_cancel.c AND NOT TARGET test_combat_block_cancel)
    add_executable(test_combat_block_cancel unit/test_combat_block_cancel.c)
    target_link_libraries(test_combat_block_cancel PRIVATE rogue_core)
    target_compile_definitions(test_combat_block_cancel PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_block_cancel PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_block_cancel COMMAND test_combat_block_cancel)
endif()

# Explicitly add Phase 4.5 reaction cancel & DI test (ensure picked up even if glob cache stale)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase4_reaction_cancel_di.c AND NOT TARGET test_combat_phase4_reaction_cancel_di)
    add_executable(test_combat_phase4_reaction_cancel_di unit/test_combat_phase4_reaction_cancel_di.c)
    target_link_libraries(test_combat_phase4_reaction_cancel_di PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase4_reaction_cancel_di PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase4_reaction_cancel_di PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase4_reaction_cancel_di COMMAND test_combat_phase4_reaction_cancel_di)
endif()

# Explicitly add Phase 4.6 i-frame overlap protection test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase4_iframe_overlap.c AND NOT TARGET test_combat_phase4_iframe_overlap)
    add_executable(test_combat_phase4_iframe_overlap unit/test_combat_phase4_iframe_overlap.c)
    target_link_libraries(test_combat_phase4_iframe_overlap PRIVATE rogue_core)
    target_compile_definitions(test_combat_phase4_iframe_overlap PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase4_iframe_overlap PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase4_iframe_overlap COMMAND test_combat_phase4_iframe_overlap)
endif()

# Explicitly add combat drift timing test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_drift_timing.c AND NOT TARGET test_combat_drift_timing)
    add_executable(test_combat_drift_timing unit/test_combat_drift_timing.c)
    target_link_libraries(test_combat_drift_timing PRIVATE rogue_core)
    target_compile_definitions(test_combat_drift_timing PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_drift_timing PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_drift_timing COMMAND test_combat_drift_timing)
endif()

# Explicitly add combat multi-hit window test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_multi_hit.c AND NOT TARGET test_combat_multi_hit)
    add_executable(test_combat_multi_hit unit/test_combat_multi_hit.c)

    target_link_libraries(test_combat_multi_hit PRIVATE rogue_core)
    target_compile_definitions(test_combat_multi_hit PRIVATE TEST_COMBAT_PERMISSIVE=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_multi_hit PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_multi_hit COMMAND test_combat_multi_hit)
endif()

# Explicitly add combat events test (Phase 1A.5 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_events.c AND NOT TARGET test_combat_events)
    add_executable(test_combat_events unit/test_combat_events.c)
    target_link_libraries(test_combat_events PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_events PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_events COMMAND test_combat_events)
endif()

# Explicitly add passive skills test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_skills_passive.c AND NOT TARGET test_skills_passive)
    add_executable(test_skills_passive unit/test_skills_passive.c)
    target_link_libraries(test_skills_passive PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_skills_passive PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_skills_passive COMMAND test_skills_passive)
endif()

# Explicitly add fireball skill test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_fireball_skill.c AND NOT TARGET test_fireball_skill)
    add_executable(test_fireball_skill unit/test_fireball_skill.c)
    target_link_libraries(test_fireball_skill PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_fireball_skill PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_fireball_skill COMMAND test_fireball_skill)
endif()

# Explicitly add fireball skill test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_skill_fireball.c AND NOT TARGET test_skill_fireball)
    add_executable(test_skill_fireball unit/test_skill_fireball.c)
    target_link_libraries(test_skill_fireball PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_skill_fireball PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_skill_fireball COMMAND test_skill_fireball)
endif()

# Explicitly add A* pathfinding test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_astar.c AND NOT TARGET test_astar)
    add_executable(test_astar unit/test_astar.c)
    target_link_libraries(test_astar PRIVATE rogue_core)
    # Prevent SDL from redefining main to SDL_main when SDL headers transitively included
    target_compile_definitions(test_astar PRIVATE SDL_MAIN_HANDLED=1)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_astar PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_astar COMMAND test_astar)
endif()

file(GLOB INTEGRATION_TESTS integration/test_*.c)
foreach(it ${INTEGRATION_TESTS})
    get_filename_component(name ${it} NAME_WE)
    add_executable(${name} ${it})
    target_link_libraries(${name} PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(${name} PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    if(ROGUE_ENABLE_SDL)
        add_test(NAME ${name} COMMAND ${name})
        set_tests_properties(${name} PROPERTIES ENVIRONMENT "SDL_VIDEODRIVER=dummy")
    else()
        add_test(NAME ${name} COMMAND ${name})
    endif()
endforeach()

# Explicitly add inventory persistence test (loot phase 4)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase4_inventory_persistence.c AND NOT TARGET test_loot_phase4_inventory_persistence)
    add_executable(test_loot_phase4_inventory_persistence unit/test_loot_phase4_inventory_persistence.c)
    target_link_libraries(test_loot_phase4_inventory_persistence PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase4_inventory_persistence PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase4_inventory_persistence COMMAND test_loot_phase4_inventory_persistence)

    # Phase 13 inventory UI management test
    if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_inventory_ui_phase13.c AND NOT TARGET test_inventory_ui_phase13)
        add_executable(test_inventory_ui_phase13 unit/test_inventory_ui_phase13.c)
        target_link_libraries(test_inventory_ui_phase13 PRIVATE rogue_core)
        if(ROGUE_ENABLE_SDL)
            target_compile_definitions(test_inventory_ui_phase13 PRIVATE ROGUE_HAVE_SDL=1)
        endif()
        add_test(NAME test_inventory_ui_phase13 COMMAND test_inventory_ui_phase13)
    endif()
endif()

# Phase 14 equipment expanded stat pipeline test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase14_extended.c AND NOT TARGET test_equipment_phase14_extended)
    add_executable(test_equipment_phase14_extended unit/test_equipment_phase14_extended.c)
    target_link_libraries(test_equipment_phase14_extended PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase14_extended PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase14_extended COMMAND test_equipment_phase14_extended)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase14_perf.c AND NOT TARGET test_equipment_phase14_perf)
    add_executable(test_equipment_phase14_perf unit/test_equipment_phase14_perf.c)
    target_link_libraries(test_equipment_phase14_perf PRIVATE rogue_core)
    if(ROGUE_BUILD_WITH_SDL2)
        target_compile_definitions(test_equipment_phase14_perf PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase14_perf COMMAND test_equipment_phase14_perf)
endif()

# Equipment System Phase 1 slot expansion test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase1_slots.c AND NOT TARGET test_equipment_phase1_slots)
    add_executable(test_equipment_phase1_slots unit/test_equipment_phase1_slots.c)
    target_link_libraries(test_equipment_phase1_slots PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase1_slots PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase1_slots COMMAND test_equipment_phase1_slots)
endif()

# Equipment System Phase 1 cosmetic transmog test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase1_transmog.c AND NOT TARGET test_equipment_phase1_transmog)
    add_executable(test_equipment_phase1_transmog unit/test_equipment_phase1_transmog.c)
    target_link_libraries(test_equipment_phase1_transmog PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase1_transmog PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase1_transmog COMMAND test_equipment_phase1_transmog)
endif()

# Equipment System Phase 1.7 persistence & atomicity test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase1_persistence.c AND NOT TARGET test_equipment_phase1_persistence)
    add_executable(test_equipment_phase1_persistence unit/test_equipment_phase1_persistence.c)
    target_link_libraries(test_equipment_phase1_persistence PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase1_persistence PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase1_persistence COMMAND test_equipment_phase1_persistence)
endif()

# Equipment System Phase 2 stat cache layering & fingerprint test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase2_stat_cache.c AND NOT TARGET test_equipment_phase2_stat_cache)
    add_executable(test_equipment_phase2_stat_cache unit/test_equipment_phase2_stat_cache.c)
    target_link_libraries(test_equipment_phase2_stat_cache PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase2_stat_cache PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase2_stat_cache COMMAND test_equipment_phase2_stat_cache)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase2_affix_layers.c AND NOT TARGET test_equipment_phase2_affix_layers)
    add_executable(test_equipment_phase2_affix_layers unit/test_equipment_phase2_affix_layers.c)
    target_link_libraries(test_equipment_phase2_affix_layers PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase2_affix_layers PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase2_affix_layers COMMAND test_equipment_phase2_affix_layers)
endif()
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase2_resists.c AND NOT TARGET test_equipment_phase2_resists)
    add_executable(test_equipment_phase2_resists unit/test_equipment_phase2_resists.c)
    target_link_libraries(test_equipment_phase2_resists PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase2_resists PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase2_resists COMMAND test_equipment_phase2_resists)
endif()

# Equipment System Phase 3 item level & budget governance test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase3_budget.c AND NOT TARGET test_equipment_phase3_budget)
    add_executable(test_equipment_phase3_budget unit/test_equipment_phase3_budget.c)
    target_link_libraries(test_equipment_phase3_budget PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase3_budget PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase3_budget COMMAND test_equipment_phase3_budget)
endif()

# Equipment System Phase 4.1 implicit layer test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase4_1_implicits.c AND NOT TARGET test_equipment_phase4_1_implicits)
    add_executable(test_equipment_phase4_1_implicits unit/test_equipment_phase4_1_implicits.c)
    target_link_libraries(test_equipment_phase4_1_implicits PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase4_1_implicits PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase4_1_implicits COMMAND test_equipment_phase4_1_implicits)
endif()

# Equipment System Phase 4.2 unique layer test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase4_2_uniques.c AND NOT TARGET test_equipment_phase4_2_uniques)
    add_executable(test_equipment_phase4_2_uniques unit/test_equipment_phase4_2_uniques.c)
    target_link_libraries(test_equipment_phase4_2_uniques PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase4_2_uniques PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase4_2_uniques COMMAND test_equipment_phase4_2_uniques)
endif()

# Equipment System Phase 4.3-4.6 sets & runewords precedence test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_phase4_3_5_sets_runewords.c AND NOT TARGET test_equipment_phase4_3_5_sets_runewords)
    add_executable(test_equipment_phase4_3_5_sets_runewords unit/test_equipment_phase4_3_5_sets_runewords.c)
    target_link_libraries(test_equipment_phase4_3_5_sets_runewords PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_phase4_3_5_sets_runewords PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_phase4_3_5_sets_runewords COMMAND test_equipment_phase4_3_5_sets_runewords)
endif()

# Explicitly add loot phase 5 rarity parse test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase5_rarity_parse.c AND NOT TARGET test_loot_phase5_rarity_parse)
    add_executable(test_loot_phase5_rarity_parse unit/test_loot_phase5_rarity_parse.c)
    target_link_libraries(test_loot_phase5_rarity_parse PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase5_rarity_parse PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase5_rarity_parse COMMAND test_loot_phase5_rarity_parse)
endif()

# Explicitly add loot phase 5 rarity roll test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase5_rarity_roll.c AND NOT TARGET test_loot_phase5_rarity_roll)
    add_executable(test_loot_phase5_rarity_roll unit/test_loot_phase5_rarity_roll.c)
    target_link_libraries(test_loot_phase5_rarity_roll PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase5_rarity_roll PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase5_rarity_roll COMMAND test_loot_phase5_rarity_roll)
endif()

# Explicitly add loot phase 6 merge/despawn test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_loot_phase6_merge_despawn.c AND NOT TARGET test_loot_phase6_merge_despawn)
    add_executable(test_loot_phase6_merge_despawn unit/test_loot_phase6_merge_despawn.c)
    target_link_libraries(test_loot_phase6_merge_despawn PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_loot_phase6_merge_despawn PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_loot_phase6_merge_despawn COMMAND test_loot_phase6_merge_despawn)
endif()

# Explicitly add equipment stat bonus test (14.2 partial)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_stat_bonus.c AND NOT TARGET test_equipment_stat_bonus)
    add_executable(test_equipment_stat_bonus unit/test_equipment_stat_bonus.c)
    target_link_libraries(test_equipment_stat_bonus PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_stat_bonus PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_stat_bonus COMMAND test_equipment_stat_bonus)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_stat_cache.c AND NOT TARGET test_stat_cache)
    add_executable(test_stat_cache unit/test_stat_cache.c)
    target_link_libraries(test_stat_cache PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_stat_cache PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_stat_cache COMMAND test_stat_cache)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_equipment_unequip_delta.c AND NOT TARGET test_equipment_unequip_delta)
    add_executable(test_equipment_unequip_delta unit/test_equipment_unequip_delta.c)
    target_link_libraries(test_equipment_unequip_delta PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_equipment_unequip_delta PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_equipment_unequip_delta COMMAND test_equipment_unequip_delta)
endif()

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_repair_costs.c AND NOT TARGET test_repair_costs)
    add_executable(test_repair_costs unit/test_repair_costs.c)
    target_link_libraries(test_repair_costs PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_repair_costs PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_repair_costs COMMAND test_repair_costs)
endif()

# Add the new Phase 5.7 lock-on obstruction & latency test (guarded for incremental reconfigure)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase5_lock_on_obstruction_latency.c AND NOT TARGET test_combat_phase5_lock_on_obstruction_latency)
    add_executable(test_combat_phase5_lock_on_obstruction_latency unit/test_combat_phase5_lock_on_obstruction_latency.c)
    set_target_properties(test_combat_phase5_lock_on_obstruction_latency PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR})
    target_link_libraries(test_combat_phase5_lock_on_obstruction_latency PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase5_lock_on_obstruction_latency PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase5_lock_on_obstruction_latency COMMAND test_combat_phase5_lock_on_obstruction_latency)
endif()

# Explicitly add multi-target lock-on test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_combat_phase5_lock_on_multitarget.c AND NOT TARGET test_combat_phase5_lock_on_multitarget)
    add_executable(test_combat_phase5_lock_on_multitarget unit/test_combat_phase5_lock_on_multitarget.c)
    target_link_libraries(test_combat_phase5_lock_on_multitarget PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_combat_phase5_lock_on_multitarget PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_combat_phase5_lock_on_multitarget COMMAND test_combat_phase5_lock_on_multitarget)
endif()

# UI Phase 1 basic context & primitive test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase1_basic.c AND NOT TARGET test_ui_phase1_basic)
    add_executable(test_ui_phase1_basic unit/test_ui_phase1_basic.c)
    target_link_libraries(test_ui_phase1_basic PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase1_basic PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase1_basic COMMAND test_ui_phase1_basic)
endif()

# UI Phase 1 extended features (1.4-1.7) test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase1_features_ext.c AND NOT TARGET test_ui_phase1_features_ext)
    add_executable(test_ui_phase1_features_ext unit/test_ui_phase1_features_ext.c)
    target_link_libraries(test_ui_phase1_features_ext PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase1_features_ext PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase1_features_ext COMMAND test_ui_phase1_features_ext)
endif()

# UI Phase 2 core primitives test (Image/Sprite/ProgressBar)
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase2_primitives.c AND NOT TARGET test_ui_phase2_primitives)
    add_executable(test_ui_phase2_primitives unit/test_ui_phase2_primitives.c)
    target_link_libraries(test_ui_phase2_primitives PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase2_primitives PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase2_primitives COMMAND test_ui_phase2_primitives)
endif()

# UI Phase 2.3/2.7 layout + id hashing test explicit add
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase2_layout_id.c AND NOT TARGET test_ui_phase2_layout_id)
    add_executable(test_ui_phase2_layout_id unit/test_ui_phase2_layout_id.c)
    target_link_libraries(test_ui_phase2_layout_id PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase2_layout_id PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase2_layout_id COMMAND test_ui_phase2_layout_id)
endif()

# UI Phase 2.4/2.5/2.8 scroll + tooltip + navigation test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase2_scroll_tooltip_nav.c AND NOT TARGET test_ui_phase2_scroll_tooltip_nav)
    add_executable(test_ui_phase2_scroll_tooltip_nav unit/test_ui_phase2_scroll_tooltip_nav.c)
    target_link_libraries(test_ui_phase2_scroll_tooltip_nav PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase2_scroll_tooltip_nav PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase2_scroll_tooltip_nav COMMAND test_ui_phase2_scroll_tooltip_nav)
endif()

# UI Phase 2.2 interactive widgets test
if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/unit/test_ui_phase2_interactive.c AND NOT TARGET test_ui_phase2_interactive)
    add_executable(test_ui_phase2_interactive unit/test_ui_phase2_interactive.c)
    target_link_libraries(test_ui_phase2_interactive PRIVATE rogue_core)
    if(ROGUE_ENABLE_SDL)
        target_compile_definitions(test_ui_phase2_interactive PRIVATE ROGUE_HAVE_SDL=1)
    endif()
    add_test(NAME test_ui_phase2_interactive COMMAND test_ui_phase2_interactive)
endif()
