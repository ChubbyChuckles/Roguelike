Audio/VFX Phase 1.5: frame compaction + tests

- Implemented frame-level compaction in FX dispatcher: identical events by key (type, priority, id) are merged with a 'repeats' count.
- Digest now mixes repeat count to keep replay hash stable while reflecting merged intensity.
- Audio dispatch scales simple gain by repeats with soft clip; guarded for SDL_mixer presence.
- Added tests/unit/test_audio_vfx_phase1_5_compaction.c and registered both FX tests with CTest.
- Updated roadmap (1.5 Done) and kept docs/README in sync.

Audio/VFX Phase 1-2: add minimal event bus, audio registry, and LEVELUP cue routing

- Implement Phase 1 core event system:
  - Define RogueEffectEvent (type, priority, payload id, timing fields).
  - Double-buffered global FX queue with deterministic (priority, seq) ordering.
  - Submission API rogue_fx_emit + per-frame begin/end hooks and stable frame digest.
- Implement Phase 2.1 audio registry with SDL_mixer-backed Mix_Chunk loading.
  - Register LEVELUP sound from assets/sounds.cfg and enable id-based playback.
- Integrate bus into app_step: begin/end each frame and dispatch before present.
- Route level-up sound through FX bus from player_progress.
- Add unit test (test_audio_vfx_phase1_2) for ordering and digest determinism.
- CMake: include src/audio_vfx/effects.c and new test target.

Roadmap updates:
- Mark 1.1–1.3 Done, 1.4 Partial; 2.1 Done (minimal). Add notes and next actions.skills: talents v2 serialization (varint ranks, v1 back-compat) + deterministic hash incl. ranks; add unit test

Details:
- Implemented header v2 with unlocked bitset + varint ranks; v1 load maps unlocked→rank=1.
- Hash now folds version marker and non-zero ranks; stable independent of unlock order.
- Added test `test_talents_phase1b_ranks_and_hash`; all talents tests pass.
- Built Debug with SDL2 and parallelism (-j8).

Audio/VFX Phase 2.2–2.7: mixer, positional, variation, voice cap + tests

- Implemented audio mixer: master gain, per-category gains, and global mute; exposed getters/setters.
- Added positional attenuation stub: listener position, enable toggle, linear falloff radius; math validated via test helper.
- Deterministic variation selection (xorshift32 seeded with frame index + seq) and simple voice cap guard in dispatcher.
- Audio registry helpers (get_path, clear) and pure-function `rogue_audio_debug_effective_gain` for headless tests.
- Unit tests added: test_audio_vfx_phase2_2_mixer_gain, test_audio_vfx_phase2_3_mute, test_audio_vfx_phase2_6_positional, test_audio_vfx_phase2_1_registry_clear. All pass.
- Updated roadmap (Phase 2.2–2.7 Done) and README changelog.
- Built Debug with SDL2 and parallelism (-j8); ran focused CTest -R audio_vfx → 6/6 pass.

Audio/VFX Phase 3.1: VFX foundations (registry, pooled instances, time controls) + test

- Implemented minimal VFX subsystem in src/audio_vfx/effects.[ch]:
  - VFX registry (id -> {layer, world_space, lifetime_ms}) with clear/get helpers.
  - Active instance pool (cap 256) with per-layer counts and debug peek-first helper.
  - Time controls: global timescale scalar and freeze toggle applied during update aging; expired instances recycled.
  - Public spawn API (rogue_vfx_spawn_by_id) and dispatcher integration for ROGUE_FX_VFX_SPAWN.
- Added unit test tests/unit/test_audio_vfx_phase3_1_vfx_foundations.c exercising spawn via FX event, counts, peek helper, freeze & timescale behavior, and expiry; registered target in CMake.
- Build: Debug with SDL2 using parallelism (-j8) succeeds; CTest filtered -R audio_vfx passes 7/7.
- Documentation: Updated roadmap (3.1 Done; 3.3/3.4/3.6 Partial; 3.5 Done) and README changelog with Phase 3.1 entry.

Audio/VFX Phase 3.2: particle system core (emitters, pool, expiry) + tests

- Added per-VFX emitter configuration API `rogue_vfx_registry_set_emitter(id, hz, p_lifetime_ms, cap)`.
- Implemented global particle pool (1024), per-instance fractional emission accumulator, and strict expiry on age_ms > lifetime_ms.
- Update loop spawns at instance position; enforces per-instance cap.
- Unit test `tests/unit/test_audio_vfx_phase3_2_particles_core.c` validates emission/expiry for 50 Hz, 200 ms lifetime, cap=10 (counts 5→10→5); registered in CMake.
- Build: Debug with SDL2 using `--parallel 8`; audio_vfx tests pass 8/8 post-boundary fix.
- Docs: Roadmap updated (3.2 Done), README changelog entry added.

Audio/VFX Phase 3.4: particle layer ordering helper + test

- Introduced `rogue_vfx_particles_collect_ordered(uint8_t* out_layers, int max)` returning only layers with active particles in BG→MID→FG→UI order for renderer iteration.
- Added unit test `tests/unit/test_audio_vfx_phase3_4_particle_layer_order.c` validating ordering with and without UI layer; registered target/test in CMake.
- Build: Debug with SDL2 and `--parallel 8`; audio_vfx suite now 9/9 passing.
- Docs: Roadmap updated (3.4 Partial with helper+test complete), README changelog entry added.

Audio/VFX Phase 3.6: screen-space vs world-space transforms + test

- Added camera state setter `rogue_vfx_set_camera(cam_x, cam_y, pixels_per_world)` and screen-space particle collector `rogue_vfx_particles_collect_screen(float* out_xy, uint8_t* out_layers, int max)`.
- World-space particles are transformed by subtracting camera and scaling by pixels_per_world; screen-space particles bypass transform.
- New unit test `tests/unit/test_audio_vfx_phase3_6_screen_vs_world.c` validates MID(world) vs UI(screen) behavior and preserves layer tagging; test registered in CMake.
- Build: Debug with SDL2 `--parallel 8`; ran `ctest -j8 -R audio_vfx` → 10/10 passing.
- Docs: Roadmap marks 3.6 Done; README changelog updated with Phase 3.6 entry.

Audio/VFX Phase 4.1: VFX authoring config loader (CSV) + tests

- Implemented CSV-based loader `rogue_vfx_load_cfg` in src/audio_vfx/vfx_config.c/.h.
- Supported columns: id, layer (0..3 or BG/MID/FG/UI), lifetime_ms, world_space (0/1,true/false), emit_hz, particle_lifetime_ms, max_particles.
- Registers VFX and applies emitter settings; parser is MSVC-portable (no non-standard strcasecmp/unsafe strncpy).
- Added unit test `tests/unit/test_audio_vfx_phase4_1_vfx_config_loader.c` that writes a temp CSV, loads it, spawns instances, steps update, and asserts particles on expected layers.
- CMake: wired vfx_config.c and new test; Debug build with SDL2 `--parallel 8` succeeds.
- Tests: `ctest -C Debug -j8 -R audio_vfx` → 11/11 passing.
- Docs: Roadmap marks 4.1 Done; README changelog updated with Phase 4.1 entry.

Audio/VFX Phase 4.2: hot reload wiring + validation error reporting + test

- Added hot-reload integration for VFX CSV via `rogue_vfx_config_watch(path)` using shared util/hot_reload.
- Introduced error tracking APIs `rogue_vfx_last_cfg_error_count` and `rogue_vfx_last_cfg_error_get` to surface load/parse issues.
- Unit test `tests/unit/test_audio_vfx_phase4_2_hot_reload_and_validation.c` validates live reload after file edit and captures validation errors on malformed rows.
- Build: Debug with SDL2 `--parallel 8` succeeded; tests: `ctest -C Debug -j8 -R audio_vfx` → 12/12 passing.
- Docs: Roadmap marks 4.2 Done; README changelog will reflect Phase 4.2.

Audio/VFX Phase 4.3 – Effect composition (chain & parallel)

- Added composite VFX support to src/audio_vfx/effects.[ch]
  - Registry/API: rogue_vfx_registry_define_composite(id, layer, lifetime_ms, world_space, child_ids, delays_ms, child_count, chain_mode)
  - Runtime: composite instances schedule child spawns during rogue_vfx_update; CHAIN uses delays relative to prior child, PARALLEL uses delays from t0
  - Limits: up to 8 children per composite; children resolved by id at definition time
- Tests: new tests/unit/test_audio_vfx_phase4_3_composition.c validates order/timing for CHAIN and PARALLEL and expiry behavior
- Build: Debug with SDL2 using parallel -j8 succeeded; ctest -R audio_vfx now 13/13 pass
- Docs: Updated roadmaps/implementation_plan_audiovfxsystem.txt to mark 4.3 Done and added notes; README changelog updated with 4.3 entry

Follow-ups
- 4.4 Parameter overrides per instance (lifetime/scale/color) on spawn path
- 4.5 Random distributions for variation (delays, emit Hz, particle lifetimes)

Audio/VFX Phase 4.4: VFX parameter overrides (lifetime/scale/color) + tests

- Added per-instance override struct `RogueVfxOverrides { lifetime_ms, scale, color_rgba }` and spawn API `rogue_vfx_spawn_with_overrides`.
- Instances now honor `lifetime_ms` override; particles spawned inherit `scale` (default 1.0) and `color_rgba` (default 0xFFFFFFFF) from the owning instance.
- Implemented debug collectors `rogue_vfx_particles_collect_scales` and `rogue_vfx_particles_collect_colors` for tests/tools.
- New unit test `tests/unit/test_audio_vfx_phase4_4_parameter_overrides.c` validates override behavior; audio_vfx suite passes 14/14 in Debug with SDL2 (`ctest -j8 -R audio_vfx`).
- Roadmap updated (4.4 Done) and README changelog updated.
